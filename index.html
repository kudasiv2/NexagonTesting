<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nexagon - Next Generation Investment Protocol</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/web3@latest/dist/web3.min.js"></script>
    <style>
        :root {
            --bg-body: #050505;
            --bg-card: rgba(20, 20, 20, 0.6);
            --bg-card-hover: rgba(30, 30, 30, 0.8);
            --primary: #8B5CF6;
            --primary-dark: #6D28D9;
            --secondary: #00D2FF;
            --accent-gold: #FFD700;
            --text-main: #FFFFFF;
            --text-muted: #9CA3AF;
            --success: #10B981;
            --error: #EF4444;
            --gradient-main: linear-gradient(135deg, #6D28D9 0%, #8B5CF6 100%);
            --gradient-gold: linear-gradient(135deg, #F59E0B 0%, #FFD700 100%);
            --gradient-glow: radial-gradient(circle at center, rgba(139, 92, 246, 0.15) 0%, transparent 70%);
            --border-light: rgba(255, 255, 255, 0.08);
            --shadow-card: 0 8px 32px 0 rgba(0, 0, 0, 0.3);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Outfit', sans-serif;
            scroll-behavior: smooth;
        }

        body {
            background-color: var(--bg-body);
            color: var(--text-main);
            line-height: 1.6;
            overflow-x: hidden;
            background-image: 
                radial-gradient(circle at 10% 20%, rgba(111, 66, 193, 0.1) 0%, transparent 40%),
                radial-gradient(circle at 90% 80%, rgba(0, 210, 255, 0.05) 0%, transparent 40%);
        }

        .container {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 24px;
        }

        /* Notifications (Toast) */
        .toast-container {
            position: fixed;
            top: 24px;
            right: 24px;
            z-index: 9999;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .toast {
            background: rgba(18, 18, 18, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid var(--border-light);
            border-left: 4px solid var(--primary);
            padding: 16px 20px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            gap: 12px;
            min-width: 300px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            transform: translateX(120%);
            transition: transform 0.3s cubic-bezier(0.68, -0.55, 0.27, 1.55);
        }

        .toast.show {
            transform: translateX(0);
        }

        .toast.success { border-left-color: var(--success); }
        .toast.error { border-left-color: var(--error); }
        
        .toast i { font-size: 20px; }
        .toast.success i { color: var(--success); }
        .toast.error i { color: var(--error); }
        
        .toast-content h4 { font-size: 14px; margin-bottom: 2px; }
        .toast-content p { font-size: 12px; color: var(--text-muted); }

        /* Header */
        header {
            background: rgba(5, 5, 5, 0.8);
            backdrop-filter: blur(20px);
            position: fixed;
            width: 100%;
            z-index: 1000;
            border-bottom: 1px solid var(--border-light);
            height: 80px;
            display: flex;
            align-items: center;
        }

        .header-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .logo img {
            height: 40px;
        }

        .logo-text {
            font-size: 26px;
            font-weight: 700;
            background: var(--gradient-main);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            letter-spacing: -0.5px;
        }

        nav ul {
            display: flex;
            list-style: none;
            gap: 32px;
        }

        nav ul li a {
            color: var(--text-muted);
            text-decoration: none;
            font-weight: 500;
            font-size: 15px;
            transition: all 0.3s;
        }

        nav ul li a:hover, nav ul li a.active {
            color: var(--text-main);
        }

        .btn-connect {
            background: var(--gradient-main);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(139, 92, 246, 0.3);
        }

        .btn-connect:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(139, 92, 246, 0.5);
        }

        .wallet-info-badge {
            background: rgba(139, 92, 246, 0.1);
            border: 1px solid rgba(139, 92, 246, 0.3);
            color: var(--primary);
            padding: 10px 20px;
            border-radius: 12px;
            font-weight: 600;
            font-family: 'Courier New', monospace;
            display: none; /* Hidden by default */
            align-items: center;
            gap: 8px;
        }

        /* Hero */
        .hero {
            padding: 180px 0 100px;
            position: relative;
            text-align: center;
        }

        .hero::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 100%;
            height: 100%;
            background: var(--gradient-glow);
            z-index: -1;
            pointer-events: none;
        }

        .hero h1 {
            font-size: 64px;
            line-height: 1.1;
            margin-bottom: 24px;
            font-weight: 700;
        }

        .hero h1 span {
            background: var(--gradient-main);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .hero p {
            font-size: 20px;
            color: var(--text-muted);
            max-width: 700px;
            margin: 0 auto 40px;
        }

        .hero-actions {
            display: flex;
            justify-content: center;
            gap: 16px;
            margin-bottom: 60px;
        }

        .btn-hero {
            padding: 16px 40px;
            border-radius: 14px;
            font-size: 18px;
            font-weight: 600;
            text-decoration: none;
            transition: all 0.3s;
            border: none;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 10px;
        }

        .btn-primary {
            background: var(--text-main);
            color: var(--bg-body);
        }
        
        .btn-primary:hover {
            background: #e0e0e0;
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(255,255,255,0.1);
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.05);
            color: var(--text-main);
            border: 1px solid var(--border-light);
            backdrop-filter: blur(10px);
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: rgba(255, 255, 255, 0.2);
        }

        .hero-stats {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 24px;
            margin-top: 60px;
            background: var(--bg-card);
            padding: 30px;
            border-radius: 24px;
            border: 1px solid var(--border-light);
            backdrop-filter: blur(20px);
        }

        .stat-item h3 {
            font-size: 32px;
            background: var(--gradient-main);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .stat-item p {
            font-size: 14px;
            color: var(--text-muted);
            margin: 0;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        /* Generic Section Styles */
        section {
            padding: 100px 0;
        }

        .section-header {
            text-align: center;
            margin-bottom: 60px;
        }

        .section-header h2 {
            font-size: 42px;
            margin-bottom: 16px;
        }

        .section-header p {
            color: var(--text-muted);
        }

        /* Cards */
        .card {
            background: var(--bg-card);
            border: 1px solid var(--border-light);
            border-radius: 24px;
            padding: 40px 30px;
            transition: all 0.4s;
            position: relative;
            overflow: hidden;
            backdrop-filter: blur(10px);
        }

        .card:hover {
            transform: translateY(-10px);
            background: var(--bg-card-hover);
            border-color: rgba(139, 92, 246, 0.4);
            box-shadow: var(--shadow-card);
        }

        /* Plan Cards */
        .plans-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 30px;
        }

        .plan-card .roi {
            font-size: 48px;
            font-weight: 700;
            color: var(--primary);
            margin: 20px 0;
        }

        .plan-card .roi span {
            font-size: 18px;
            color: var(--text-muted);
            font-weight: 400;
        }

        .plan-features li {
            display: flex;
            justify-content: space-between;
            margin-bottom: 16px;
            padding-bottom: 16px;
            border-bottom: 1px solid var(--border-light);
            font-size: 15px;
        }

        .plan-features li:last-child {
            border-bottom: none;
        }

        .plan-btn {
            width: 100%;
            margin-top: 20px;
        }

        /* Referral & Leadership Layout */
        .program-layout {
            display: flex;
            flex-direction: column;
            gap: 30px;
        }

        .stats-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }

        .stat-box {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid var(--border-light);
            padding: 24px;
            border-radius: 16px;
            text-align: center;
        }

        .withdraw-area {
            display: flex;
            justify-content: center;
            padding: 10px 0;
        }

        .levels-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            gap: 16px;
        }

        .level-card {
            background: rgba(20, 20, 20, 0.8);
            border: 1px solid var(--border-light);
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            transition: all 0.3s;
            position: relative;
        }

        .level-card.locked {
            opacity: 0.5;
            filter: grayscale(100%);
        }

        .level-card.locked::after {
            content: '\f023'; /* FontAwesome Padlock */
            font-family: 'Font Awesome 6 Free';
            font-weight: 900;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 32px;
            color: rgba(255,255,255,0.5);
        }
        
        .level-card.unlocked {
            border-color: var(--primary);
            box-shadow: 0 0 15px rgba(139, 92, 246, 0.2);
        }

        .level-percent {
            font-size: 24px;
            font-weight: 700;
            color: var(--primary);
        }

        .level-req {
            font-size: 12px;
            color: var(--text-muted);
            margin-top: 5px;
        }

        /* Leadership Specific */
        .leadership-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 24px;
        }

        /* Footer */
        footer {
            background: black;
            border-top: 1px solid var(--border-light);
            padding: 80px 0 40px;
            text-align: center;
        }

        .social-links {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 30px 0;
        }

        .social-btn {
            width: 45px;
            height: 45px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            color: var(--text-muted);
            background: transparent;
            font-size: 20px;
            transition: all 0.3s;
            text-decoration: none;
        }

        .social-btn:hover {
            color: var(--primary);
            background: rgba(139, 92, 246, 0.1);
            transform: translateY(-3px);
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(5px);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: #111;
            border: 1px solid var(--border-light);
            border-radius: 24px;
            padding: 40px;
            width: 90%;
            max-width: 480px;
            position: relative;
            box-shadow: 0 20px 50px rgba(0,0,0,0.5);
        }

        .form-group {
            margin-bottom: 24px;
        }

        .form-label {
            display: block;
            margin-bottom: 10px;
            color: var(--text-muted);
            font-size: 14px;
        }

        .form-input {
            width: 100%;
            padding: 16px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--border-light);
            border-radius: 12px;
            color: white;
            font-size: 16px;
            transition: 0.3s;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--primary);
            background: rgba(139, 92, 246, 0.05);
        }

        .form-input:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .close-modal {
            position: absolute;
            top: 20px;
            right: 20px;
            background: none;
            border: none;
            color: var(--text-muted);
            font-size: 24px;
            cursor: pointer;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .hero h1 { font-size: 42px; }
            .hero-stats { grid-template-columns: 1fr; }
            nav ul { display: none; } /* Simplified mobile handling */
            .levels-grid { grid-template-columns: repeat(auto-fill, minmax(100px, 1fr)); }
        }
    </style>
</head>
<body>

    <!-- Notification System -->
    <div class="toast-container" id="toastContainer"></div>

    <!-- Header -->
    <header>
        <div class="container header-container">
            <div class="logo">
                <div class="logo-text">NEXAGON</div>
            </div>
            
            <nav>
                <ul>
                    <li><a href="#home">Home</a></li>
                    <li><a href="#dashboard">Dashboard</a></li>
                    <li><a href="#invest">Invest</a></li>
                    <li><a href="#referral">Referral</a></li>
                </ul>
            </nav>
            
            <!-- Header Connect Button (Top Right) -->
            <div>
                <button class="btn-connect" id="headerConnectBtn">
                    <i class="fas fa-wallet" style="margin-right: 8px;"></i> Connect Wallet
                </button>
                <div class="wallet-info-badge" id="headerWalletInfo">
                    <span id="headerWalletAddress">0x00...0000</span>
                </div>
            </div>
        </div>
    </header>

    <!-- Hero Section -->
    <section class="hero" id="home">
        <div class="container">
            <h1>The Future of <br><span>Decentralized Wealth</span></h1>
            <p>Earn up to 16% daily returns with our advanced smart contract protocol. Automated, secure, and built for sustainability.</p>
            
            <div class="hero-actions">
                <!-- Logic: Jika belum connect, tombol ini Connect Wallet. Jika sudah, jadi Start Investing -->
                <button class="btn-hero btn-connect" id="heroConnectBtn">
                    Connect Wallet to Start
                </button>
                
                <div id="heroConnectedButtons" style="display: none; gap: 16px;">
                    <button class="btn-hero btn-primary" id="startInvestingBtn">Start Investing</button>
                    <a href="#dashboard" class="btn-hero btn-secondary">Dashboard</a>
                </div>
            </div>

            <div class="hero-stats">
                <div class="stat-item">
                    <h3 id="tvl">0 USDT</h3>
                    <p>Total Value Locked</p>
                </div>
                <div class="stat-item">
                    <h3 id="totalUsers">0</h3>
                    <p>Total Investors</p>
                </div>
                <div class="stat-item">
                    <h3 id="totalInvested">0 USDT</h3>
                    <p>Total Invested</p>
                </div>
                <div class="stat-item">
                    <h3 id="totalWithdrawn">0 USDT</h3>
                    <p>Total Withdrawn</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Dashboard -->
    <section id="dashboard">
        <div class="container">
            <div class="section-header">
                <h2>Your Dashboard</h2>
                <p>Real-time analytics of your portfolio</p>
            </div>
            
            <div class="hero-stats" style="margin-top: 0; margin-bottom: 40px;">
                <div class="stat-item">
                    <h3 id="userInvested">0 USDT</h3>
                    <p>My Investment</p>
                </div>
                <div class="stat-item">
                    <h3 id="userPending">0 USDT</h3>
                    <p>Pending Rewards</p>
                </div>
                <div class="stat-item">
                    <h3 id="userWithdrawn">0 USDT</h3>
                    <p>Total Payout</p>
                </div>
            </div>
            
            <div style="text-align: center;">
                <button class="btn-hero btn-primary" id="withdrawROI" style="width: 200px;">Withdraw ROI</button>
            </div>
        </div>
    </section>

    <!-- Invest Section -->
    <section id="invest">
        <div class="container">
            <div class="section-header">
                <h2>Investment Plans</h2>
                <p>Choose the strategy that fits your goals</p>
            </div>
            
            <div class="plans-grid">
                <!-- Gold Plan -->
                <div class="card plan-card">
                    <h3>Gold Plan</h3>
                    <div class="roi">16% <span>/ Day</span></div>
                    <ul class="plan-features">
                        <li><span>Duration</span> <span>7 Days</span></li>
                        <li><span>Total Return</span> <span>112%</span></li>
                        <li><span>Min Deposit</span> <span>10 USDT</span></li>
                        <li><span>Max Deposit</span> <span>100 USDT</span></li>
                        <li><span>Withdraw</span> <span>Every 8 Hours</span></li>
                    </ul>
                    <button class="btn-hero btn-primary plan-btn" data-plan="0" data-max="100">Invest Gold</button>
                </div>
                
                <!-- Platinum Plan -->
                <div class="card plan-card" style="border-color: var(--primary);">
                    <div style="position:absolute; top:0; right:0; background:var(--primary); padding:5px 15px; font-size:12px; font-weight:bold; border-bottom-left-radius:10px;">POPULAR</div>
                    <h3>Platinum Plan</h3>
                    <div class="roi">9% <span>/ Day</span></div>
                    <ul class="plan-features">
                        <li><span>Duration</span> <span>14 Days</span></li>
                        <li><span>Total Return</span> <span>126%</span></li>
                        <li><span>Min Deposit</span> <span>50 USDT</span></li>
                        <li><span>Max Deposit</span> <span>100 USDT</span></li>
                        <li><span>Withdraw</span> <span>Every 8 Hours</span></li>
                    </ul>
                    <button class="btn-hero btn-primary plan-btn" data-plan="1" data-max="100">Invest Platinum</button>
                </div>
                
                <!-- Diamond Plan -->
                <div class="card plan-card">
                    <h3>Diamond Plan</h3>
                    <div class="roi">5% <span>/ Day</span></div>
                    <ul class="plan-features">
                        <li><span>Duration</span> <span>30 Days</span></li>
                        <li><span>Total Return</span> <span>150%</span></li>
                        <li><span>Min Deposit</span> <span>100 USDT</span></li>
                        <li><span>Max Deposit</span> <span>Unlimited</span></li>
                        <li><span>Withdraw</span> <span>Every 8 Hours</span></li>
                    </ul>
                    <button class="btn-hero btn-primary plan-btn" data-plan="2" data-max="999999999">Invest Diamond</button>
                </div>
            </div>
        </div>
    </section>

    <!-- Referral Section -->
    <section id="referral">
        <div class="container">
            <div class="section-header">
                <h2>Referral Program</h2>
                <p>Unlock 15 levels of earnings by increasing your personal investment</p>
            </div>
            
            <div class="program-layout">
                <!-- Row 1: Stats -->
                <div class="stats-row">
                    <div class="stat-box">
                        <p>Referral Earnings</p>
                        <h3 id="referralBonus">0 USDT</h3>
                    </div>
                    <div class="stat-box">
                        <p>Current Level</p>
                        <h3 id="referralLevel">0</h3>
                    </div>
                </div>

                <!-- Row 2: Button (Positioned Between) -->
                <div class="withdraw-area">
                    <button class="btn-hero btn-secondary" id="withdrawReferral">Withdraw Referral Earnings</button>
                </div>

                <!-- Row 3: Levels (Locked by Default) -->
                <div class="levels-grid" id="referralLevelsContainer">
                    <!-- Javascript will generate this -->
                </div>
            </div>
        </div>
    </section>

    <!-- Leadership Section -->
    <section id="leadership">
        <div class="container">
            <div class="section-header">
                <h2>Leadership Program</h2>
                <p>Build your team and earn overrides</p>
            </div>
            
            <div class="program-layout">
                <div class="stats-row">
                    <div class="stat-box">
                        <p>Leadership Earnings</p>
                        <h3 id="leadershipBonus">0 USDT</h3>
                    </div>
                    <div class="stat-box">
                        <p>Team Size</p>
                        <h3 id="teamSize">0</h3>
                    </div>
                </div>

                <div class="withdraw-area">
                    <button class="btn-hero btn-secondary" id="withdrawLeadership">Withdraw Leadership Earnings</button>
                </div>

                <div class="leadership-grid" id="leadershipLevelsContainer">
                    <!-- Generated by JS -->
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer>
        <div class="container">
            <div class="logo" style="justify-content: center; margin-bottom: 20px;">
                <div class="logo-text">NEXAGON</div>
            </div>
            <p style="color: var(--text-muted); max-width: 500px; margin: 0 auto;">
                Next Generation Investment Protocol built on Binance Smart Chain. Secure, Transparent, Profitable.
            </p>
            
            <!-- Transparent Social Buttons -->
            <div class="social-links">
                <a href="#" class="social-btn"><i class="fab fa-telegram-plane"></i></a>
                <a href="#" class="social-btn"><i class="fab fa-twitter"></i></a>
                <a href="#" class="social-btn"><i class="fab fa-discord"></i></a>
                <a href="#" class="social-btn"><i class="fab fa-medium-m"></i></a>
            </div>
            
            <p style="font-size: 12px; color: #333;">&copy; 2024 Nexagon Protocol. All Rights Reserved.</p>
        </div>
    </footer>

    <!-- Investment Modal -->
    <div class="modal" id="investModal">
        <div class="modal-content">
            <button class="close-modal" id="closeInvestModal">&times;</button>
            <h2 style="margin-bottom: 30px;">Confirm Investment</h2>
            
            <div class="form-group">
                <label class="form-label">Plan Selected</label>
                <select class="form-input" id="planSelect" disabled>
                    <option value="0">Gold Plan</option>
                    <option value="1">Platinum Plan</option>
                    <option value="2">Diamond Plan</option>
                </select>
            </div>
            
            <div class="form-group">
                <label class="form-label">Amount (USDT)</label>
                <input type="number" class="form-input" id="investAmount" placeholder="Min 10 USDT">
                <small id="maxLimitText" style="color: var(--error); display:none; margin-top:5px; font-size:12px;"></small>
            </div>
            
            <div class="form-group">
                <label class="form-label">Referral Code (Fixed)</label>
                <input type="text" class="form-input" id="referralInput" placeholder="Address..." disabled>
            </div>
            
            <button class="btn-hero btn-primary" id="confirmInvest" style="width: 100%;">Invest Now</button>
        </div>
    </div>

    <!-- JavaScript Logic -->
    <script>
        // --- Configuration ---
        const CONTRACT_ADDRESS = '0xDe4F0C2F829E7fF547DA3958854d84E143985D5C';
        // Simplified ABI for Frontend Interaction
        const CONTRACT_ABI = [{"inputs":[{"internalType":"uint256","name":"_planId","type":"uint256"},{"internalType":"uint256","name":"_amount","type":"uint256"},{"internalType":"address","name":"_referrer","type":"address"}],"name":"invest","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"withdrawROI","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"withdrawReferral","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"withdrawLeadership","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"_user","type":"address"}],"name":"getUserInfo","outputs":[{"internalType":"uint256","name":"totalInvested","type":"uint256"},{"internalType":"uint256","name":"totalWithdrawn","type":"uint256"},{"internalType":"uint256","name":"activeInvestments","type":"uint256"},{"internalType":"uint256","name":"referralBonus","type":"uint256"},{"internalType":"uint256","name":"referralBonusWithdrawn","type":"uint256"},{"internalType":"uint256","name":"leadershipBonus","type":"uint256"},{"internalType":"uint256","name":"leadershipBonusWithdrawn","type":"uint256"},{"internalType":"address","name":"referrer","type":"address"},{"internalType":"uint256[15]","name":"referralLevels","type":"uint256[15]"},{"internalType":"uint256[3]","name":"leadershipLevels","type":"uint256[3]"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"getPlatformStats","outputs":[{"internalType":"uint256","name":"contractBalance","type":"uint256"},{"internalType":"uint256","name":"totalInvestors_","type":"uint256"},{"internalType":"uint256","name":"totalInvested_","type":"uint256"},{"internalType":"uint256","name":"totalWithdrawn_","type":"uint256"},{"internalType":"uint256","name":"totalReferralBonus_","type":"uint256"},{"internalType":"uint256","name":"totalLeadershipBonus_","type":"uint256"},{"internalType":"uint256","name":"referralExpiredBalance_","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"_user","type":"address"}],"name":"getPendingRewards","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"_user","type":"address"}],"name":"getTeamMembersCount","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"}];

        // --- Data ---
        const referralLevelsData = [
            { level: 1, percent: 15, req: 10 }, { level: 2, percent: 10, req: 50 },
            { level: 3, percent: 5, req: 100 }, { level: 4, percent: 5, req: 150 },
            { level: 5, percent: 3, req: 200 }, { level: 6, percent: 3, req: 250 },
            { level: 7, percent: 3, req: 300 }, { level: 8, percent: 2, req: 350 },
            { level: 9, percent: 2, req: 400 }, { level: 10, percent: 2, req: 450 },
            { level: 11, percent: 1, req: 500 }, { level: 12, percent: 1, req: 550 },
            { level: 13, percent: 1, req: 600 }, { level: 14, percent: 1, req: 650 },
            { level: 15, percent: 1, req: 700 }
        ];

        const leadershipData = [
            { name: "Bronze", percent: 3, req: 200 },
            { name: "Silver", percent: 7, req: 500 },
            { name: "Gold", percent: 10, req: 1000 }
        ];

        let web3;
        let contract;
        let userAccount;
        let currentMaxDeposit = 0; // Untuk validasi
        let currentUserTotalInvested = 0; // Untuk locking logic

        // --- Notification System (Toast) ---
        function showToast(message, type = 'success') {
            const container = document.getElementById('toastContainer');
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            
            const icon = type === 'success' ? 'fa-check-circle' : 'fa-exclamation-circle';
            const title = type === 'success' ? 'Success' : 'Error';
            
            toast.innerHTML = `
                <i class="fas ${icon}"></i>
                <div class="toast-content">
                    <h4>${title}</h4>
                    <p>${message}</p>
                </div>
            `;
            
            container.appendChild(toast);
            
            // Animation Trigger
            setTimeout(() => toast.classList.add('show'), 100);
            
            // Auto Remove
            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => toast.remove(), 400);
            }, 5000);
        }

        // --- Init & Web3 ---
        window.addEventListener('load', async () => {
            renderReferralCards(0); // Render locked initially
            renderLeadershipCards(0);
            
            // Check for Referral URL param
            const urlParams = new URLSearchParams(window.location.search);
            const refParam = urlParams.get('ref');
            if(refParam) {
                document.getElementById('referralInput').value = refParam;
            }
        });

        async function initWeb3() {
            if (window.ethereum) {
                web3 = new Web3(window.ethereum);
                try {
                    const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
                    userAccount = accounts[0];
                    contract = new web3.eth.Contract(CONTRACT_ABI, CONTRACT_ADDRESS);
                    
                    updateUIState(true);
                    loadData();
                    showToast("Wallet connected successfully!");
                } catch (error) {
                    showToast("User denied account access", "error");
                }
            } else {
                showToast("Please install MetaMask!", "error");
            }
        }

        // --- UI Updates ---
        function updateUIState(isConnected) {
            const headerBtn = document.getElementById('headerConnectBtn');
            const headerWalletInfo = document.getElementById('headerWalletInfo');
            const headerAddress = document.getElementById('headerWalletAddress');
            
            const heroConnectBtn = document.getElementById('heroConnectBtn');
            const heroConnectedButtons = document.getElementById('heroConnectedButtons');

            if (isConnected) {
                // Header: Hide button, Show info 0x00...
                headerBtn.style.display = 'none';
                headerWalletInfo.style.display = 'flex';
                headerAddress.textContent = userAccount.substring(0, 6) + '...' + userAccount.substring(userAccount.length - 4);

                // Hero: Hide big connect button, Show Start Investing buttons
                heroConnectBtn.style.display = 'none';
                heroConnectedButtons.style.display = 'flex';
                // Hero button Start Investing acts as scroll to Invest
                document.getElementById('startInvestingBtn').onclick = () => {
                    document.querySelector('#invest').scrollIntoView();
                };
            } else {
                headerBtn.style.display = 'block';
                headerWalletInfo.style.display = 'none';
                heroConnectBtn.style.display = 'inline-flex';
                heroConnectedButtons.style.display = 'none';
            }
        }

        // --- Data Loading ---
        async function loadData() {
            if(!contract) return;
            
            try {
                // 1. Platform Stats
                const stats = await contract.methods.getPlatformStats().call();
                document.getElementById('tvl').textContent = (stats.contractBalance / 1e18).toFixed(0) + ' USDT';
                document.getElementById('totalUsers').textContent = stats.totalInvestors_;
                document.getElementById('totalInvested').textContent = (stats.totalInvested_ / 1e18).toFixed(0) + ' USDT';
                document.getElementById('totalWithdrawn').textContent = (stats.totalWithdrawn_ / 1e18).toFixed(0) + ' USDT';

                // 2. User Info
                const userInfo = await contract.methods.getUserInfo(userAccount).call();
                currentUserTotalInvested = parseInt(userInfo.totalInvested) / 1e18;

                document.getElementById('userInvested').textContent = currentUserTotalInvested.toFixed(2) + ' USDT';
                document.getElementById('userWithdrawn').textContent = (userInfo.totalWithdrawn / 1e18).toFixed(2) + ' USDT';
                document.getElementById('referralBonus').textContent = (userInfo.referralBonus / 1e18).toFixed(2) + ' USDT';
                document.getElementById('leadershipBonus').textContent = (userInfo.leadershipBonus / 1e18).toFixed(2) + ' USDT';

                const pending = await contract.methods.getPendingRewards(userAccount).call();
                document.getElementById('userPending').textContent = (pending / 1e18).toFixed(2) + ' USDT';

                // 3. Render Levels based on investment
                renderReferralCards(currentUserTotalInvested);
                
                // 4. Leadership based on team
                const teamCount = await contract.methods.getTeamMembersCount(userAccount).call();
                document.getElementById('teamSize').textContent = teamCount;
                renderLeadershipCards(teamCount);

            } catch (e) {
                console.error(e);
            }
        }

        // --- Rendering Locked/Unlocked Cards ---
        function renderReferralCards(userInvestAmt) {
            const container = document.getElementById('referralLevelsContainer');
            container.innerHTML = '';
            
            referralLevelsData.forEach(lvl => {
                const isUnlocked = userInvestAmt >= lvl.req;
                const statusClass = isUnlocked ? 'unlocked' : 'locked';
                
                const html = `
                    <div class="level-card ${statusClass}">
                        <div style="font-size:14px; margin-bottom:5px;">Level ${lvl.level}</div>
                        <div class="level-percent">${lvl.percent}%</div>
                        <div class="level-req">Req: ${lvl.req} USDT</div>
                    </div>
                `;
                container.innerHTML += html;
            });

            // Set current level text
            let currentLvl = 0;
            for(let i=0; i<referralLevelsData.length; i++) {
                if(userInvestAmt >= referralLevelsData[i].req) currentLvl = i+1;
                else break;
            }
            document.getElementById('referralLevel').textContent = currentLvl;
        }

        function renderLeadershipCards(teamCount) {
            const container = document.getElementById('leadershipLevelsContainer');
            container.innerHTML = '';

            leadershipData.forEach(data => {
                const isUnlocked = teamCount >= data.req;
                const statusClass = isUnlocked ? 'unlocked' : 'locked';
                
                const html = `
                    <div class="card level-card ${statusClass}" style="padding: 20px;">
                        <h3 style="color:var(--primary); font-size:18px;">${data.name} Leader</h3>
                        <div class="level-percent" style="font-size:32px; margin:10px 0;">${data.percent}%</div>
                        <p style="font-size:13px; color:var(--text-muted);">Requirement: <br> ${data.req} Active Members</p>
                    </div>
                `;
                container.innerHTML += html;
            });
        }

        // --- Interaction Logic ---
        
        // Connect Buttons
        document.getElementById('headerConnectBtn').addEventListener('click', initWeb3);
        document.getElementById('heroConnectBtn').addEventListener('click', initWeb3);

        // Modal Logic
        const modal = document.getElementById('investModal');
        const planBtns = document.querySelectorAll('.plan-btn');
        
        planBtns.forEach(btn => {
            btn.addEventListener('click', (e) => {
                if(!userAccount) {
                    showToast("Please Connect Wallet first!", "error");
                    return;
                }
                const planId = e.target.getAttribute('data-plan');
                currentMaxDeposit = parseFloat(e.target.getAttribute('data-max'));
                
                document.getElementById('planSelect').value = planId;
                document.getElementById('investAmount').value = '';
                
                modal.style.display = 'flex';
            });
        });

        document.getElementById('closeInvestModal').addEventListener('click', () => {
            modal.style.display = 'none';
        });

        // Invest Action with Validation
        document.getElementById('confirmInvest').addEventListener('click', async () => {
            const planId = document.getElementById('planSelect').value;
            const amount = document.getElementById('investAmount').value;
            const referrer = document.getElementById('referralInput').value || '0x0000000000000000000000000000000000000000';

            if (!amount || amount <= 0) {
                showToast("Please enter a valid amount", "error");
                return;
            }
            
            // Validation: Max Deposit Logic
            if (parseFloat(amount) > currentMaxDeposit) {
                showToast(`Max investment for this plan is $${currentMaxDeposit}`, "error");
                return;
            }

            try {
                const amountWei = web3.utils.toWei(amount, 'ether');
                await contract.methods.invest(planId, amountWei, referrer).send({ from: userAccount });
                
                showToast("Investment Successful! Welcome to Nexagon.");
                modal.style.display = 'none';
                loadData();
            } catch (err) {
                console.error(err);
                showToast("Transaction Failed", "error");
            }
        });

        // Withdraw Buttons Logic
        const handleWithdraw = async (methodName, label) => {
            if(!contract) return;
            try {
                await contract.methods[methodName]().send({ from: userAccount });
                showToast(`${label} Withdrawal Successful!`);
                loadData();
            } catch (err) {
                showToast("Withdrawal Failed", "error");
            }
        };

        document.getElementById('withdrawROI').addEventListener('click', () => handleWithdraw('withdrawROI', 'ROI'));
        document.getElementById('withdrawReferral').addEventListener('click', () => handleWithdraw('withdrawReferral', 'Referral'));
        document.getElementById('withdrawLeadership').addEventListener('click', () => handleWithdraw('withdrawLeadership', 'Leadership'));

    </script>
</body>
</html>
