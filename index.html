<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nexagon - Next Generation Investment Protocol</title>
    <meta name="description" content="Earn stable daily returns through our optimized ROI system, backed by a 15-level referral program and secure smart contract technology">
    <link rel="icon" type="image/x-icon" href="image/favicon.ico">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800&family=Space+Grotesk:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bignumber.js@9.1.2/bignumber.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/web3@latest/dist/web3.min.js"></script>
    <style>
        :root {
            /* Premium Palette: Deep Nebula & Electric Violet */
            --bg-deep: #030014;
            --bg-card: rgba(18, 12, 33, 0.65);
            --bg-card-hover: rgba(30, 20, 50, 0.75);
            
            --primary-accent: #8b5cf6;
            --secondary-accent: #d946ef;
            --cyan-glow: #06b6d4;
            
            --text-main: #ffffff;
            --text-muted: #94a3b8;
            --text-dark: #0f172a;

            --gradient-main: linear-gradient(135deg, #7c3aed 0%, #c026d3 100%);
            --gradient-gold: linear-gradient(135deg, #fbbf24 0%, #d97706 100%);
            --gradient-dark: linear-gradient(180deg, #030014 0%, #0f0529 100%);
            
            --glass-border: 1px solid rgba(255, 255, 255, 0.08);
            --glass-shine: 1px solid rgba(255, 255, 255, 0.15);
            
            --shadow-glow: 0 0 20px rgba(124, 58, 237, 0.3);
            --shadow-card: 0 8px 32px 0 rgba(0, 0, 0, 0.37);

            /* Typography */
            --font-body: 'Outfit', sans-serif;
            --font-heading: 'Space Grotesk', sans-serif;

            /* Spacing & Radius */
            --radius-sm: 8px;
            --radius-md: 12px;
            --radius-lg: 20px;
            --radius-xl: 30px;
            
            --container-width: 1240px;
        }

        /* Modern Reset & Base */
        * { margin: 0; padding: 0; box-sizing: border-box; outline: none; -webkit-tap-highlight-color: transparent; }
        
        html { scroll-behavior: smooth; font-size: 16px; }
        
        body {
            font-family: var(--font-body);
            background-color: var(--bg-deep);
            background-image: 
                radial-gradient(circle at 15% 50%, rgba(124, 58, 237, 0.15), transparent 25%),
                radial-gradient(circle at 85% 30%, rgba(192, 38, 211, 0.1), transparent 25%);
            background-attachment: fixed;
            color: var(--text-main);
            line-height: 1.6;
            overflow-x: hidden;
            min-height: 100vh;
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: var(--bg-deep); }
        ::-webkit-scrollbar-thumb { background: #332850; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: var(--primary-accent); }

        .container {
            max-width: var(--container-width);
            margin: 0 auto;
            padding: 0 24px;
        }

        /* Typography Utilities */
        h1, h2, h3, h4 { font-family: var(--font-heading); color: var(--text-main); line-height: 1.2; }
        .gradient-text {
            background: var(--gradient-main);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            display: inline-block;
        }

        /* Preloader */
        .preloader {
            position: fixed; inset: 0;
            background: #030014;
            display: flex; flex-direction: column;
            justify-content: center; align-items: center;
            z-index: 9999;
            transition: opacity 0.6s ease, visibility 0.6s ease;
        }
        .preloader.fade-out { opacity: 0; visibility: hidden; }
        
        .loader { display: flex; gap: 6px; margin-bottom: 20px; }
        .purple-bar {
            width: 6px; height: 30px;
            background: var(--gradient-main);
            border-radius: 10px;
            animation: pulse-loader 1s ease-in-out infinite;
        }
        .purple-bar:nth-child(2) { animation-delay: 0.1s; height: 45px; }
        .purple-bar:nth-child(3) { animation-delay: 0.2s; height: 60px; }
        .purple-bar:nth-child(4) { animation-delay: 0.3s; height: 45px; }
        .purple-bar:nth-child(5) { animation-delay: 0.4s; }
        
        @keyframes pulse-loader {
            0%, 100% { transform: scaleY(0.5); opacity: 0.5; }
            50% { transform: scaleY(1); opacity: 1; box-shadow: 0 0 15px var(--primary-accent); }
        }
        
        .preloader-text { font-family: var(--font-heading); font-size: 1.5rem; letter-spacing: 4px; font-weight: 700; color: white; }

        /* Header / Navbar */
        .header {
            position: fixed; top: 0; left: 0; right: 0;
            height: 70px; /* Reduced from 90px */
            background: rgba(3, 0, 20, 0.7);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-bottom: var(--glass-border);
            z-index: 1000;
            transition: all 0.3s ease;
        }
        
        .nav { display: flex; justify-content: space-between; align-items: center; height: 100%; }
        
        .nav__logo { display: flex; align-items: center; gap: 12px; text-decoration: none; }
        .logo { width: 36px; height: 36px; filter: drop-shadow(0 0 8px rgba(124, 58, 237, 0.5)); transition: transform 0.3s ease; }
        .nav__logo:hover .logo { transform: rotate(10deg); }
        .logo__text { font-size: 1.3rem; font-weight: 700; letter-spacing: 1px; color: white; font-family: var(--font-heading); }

        .nav__menu { display: flex; align-items: center; gap: 40px; }
        .nav__list { display: flex; list-style: none; gap: 32px; }
        
        .nav__link {
            color: var(--text-muted);
            text-decoration: none;
            font-weight: 500;
            font-size: 0.95rem;
            transition: 0.3s;
            position: relative;
        }
        .nav__link:hover, .nav__link.active { color: white; text-shadow: 0 0 10px rgba(139, 92, 246, 0.6); }
        .nav__link::after {
            content: ''; position: absolute; bottom: -6px; left: 50%; transform: translateX(-50%) scaleX(0);
            width: 20px; height: 2px; background: var(--primary-accent);
            transition: 0.3s; border-radius: 2px;
        }
        .nav__link:hover::after, .nav__link.active::after { transform: translateX(-50%) scaleX(1); width: 100%; }

        .nav__toggle { display: none; font-size: 1.5rem; color: white; cursor: pointer; }

        /* Buttons */
        .btn {
            display: inline-flex; align-items: center; justify-content: center; gap: 10px;
            padding: 12px 28px;
            border-radius: 50px;
            font-weight: 600; font-size: 0.95rem; font-family: var(--font-body);
            cursor: pointer; transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            text-decoration: none; position: relative; overflow: hidden; border: none;
            letter-spacing: 0.5px;
        }
        
        .btn--primary {
            background: var(--gradient-main);
            color: white;
            box-shadow: 0 4px 20px rgba(124, 58, 237, 0.4);
        }
        .btn--primary::before {
            content: ''; position: absolute; top: 0; left: -100%; width: 100%; height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: 0.5s;
        }
        .btn--primary:hover { transform: translateY(-2px); box-shadow: 0 8px 25px rgba(192, 38, 211, 0.5); }
        .btn--primary:hover::before { left: 100%; }

        .btn--outline {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(139, 92, 246, 0.5);
            color: white;
            backdrop-filter: blur(5px);
        }
        .btn--outline:hover {
            background: rgba(139, 92, 246, 0.15);
            border-color: var(--primary-accent);
            transform: translateY(-2px);
        }

        .btn-sm { padding: 8px 20px; font-size: 0.85rem; }
        .btn-lg { padding: 12px 28px; font-size: 0.95rem; } /* Reduced from 16px 36px */

        /* Sections General */
        .section { padding: 100px 0; min-height: 100vh; display: flex; flex-direction: column; justify-content: center; }
        .section__header { text-align: center; margin-bottom: 60px; max-width: 800px; margin-left: auto; margin-right: auto; }
        .section__title {
            font-size: 3.5rem; margin-bottom: 16px; font-weight: 700;
            background: linear-gradient(to right, #fff, #b8b8b8);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
        }
        .section__subtitle { color: var(--text-muted); font-size: 1.125rem; }

        /* Cards & Glassmorphism */
        .card-glass, .stat-card, .plan-card, .floating-card, .referral-link-container, .claim-card, .info-box, .investment-form-container, .investment-success, .empty-state, .faq-item, .leadership-level-compact, .referral-level-compact, .alert, .team-members-container, .investment-history-container, .investment-history-item {
            background: var(--bg-card);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border: var(--glass-border);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-card);
        }

        /* Hero Section */
        #home { padding-top: 100px; padding-bottom: 80px; position: relative; } /* Reduced padding-top from 140px */
        .hero__container { display: grid; grid-template-columns: 1.2fr 0.8fr; gap: 60px; align-items: center; }
        
        .badge {
            background: rgba(139, 92, 246, 0.15); border: 1px solid rgba(139, 92, 246, 0.4);
            color: #d8b4fe; padding: 6px 16px; border-radius: 20px;
            font-size: 0.875rem; font-weight: 600; letter-spacing: 0.5px; margin-bottom: 24px; display: inline-block;
        }
        
        .hero__title { font-size: 4.5rem; line-height: 1.1; margin-bottom: 24px; font-weight: 800; }
        .hero__description { color: var(--text-muted); font-size: 1.25rem; margin-bottom: 40px; max-width: 90%; }
        .hero__buttons { display: flex; gap: 16px; margin-bottom: 40px; }

        .floating-card {
            padding: 32px; border-radius: var(--radius-xl);
            background: linear-gradient(160deg, rgba(30, 20, 50, 0.8) 0%, rgba(10, 5, 20, 0.9) 100%);
            border: 1px solid rgba(255,255,255,0.1);
            animation: float-hero 6s ease-in-out infinite;
            position: relative;
        }
        .floating-card::before {
            content: ''; position: absolute; inset: -1px; border-radius: inherit; padding: 1px;
            background: linear-gradient(135deg, rgba(139,92,246,0.5), transparent);
            -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
            mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
            -webkit-mask-composite: xor; mask-composite: exclude; pointer-events: none;
        }

        @keyframes float-hero {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-20px); }
        }

        .card__header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px; border-bottom: 1px solid rgba(255,255,255,0.05); padding-bottom: 16px; }
        .card__header h3 { font-size: 1.2rem; font-weight: 600; }
        .live-indicator { display: flex; align-items: center; gap: 8px; color: #4ade80; font-weight: 700; font-size: 0.85rem; }
        .dot { width: 8px; height: 8px; background: #4ade80; border-radius: 50%; box-shadow: 0 0 10px #4ade80; animation: blink 2s infinite; }
        
        .stat-item { display: flex; justify-content: space-between; padding: 12px 0; border-bottom: 1px solid rgba(255,255,255,0.03); }
        .stat-item:last-child { border-bottom: none; }
        .stat-item .label { color: var(--text-muted); font-size: 0.95rem; }
        .stat-item .value { color: white; font-weight: 600; font-family: var(--font-heading); font-size: 1.1rem; text-shadow: 0 0 10px rgba(139,92,246,0.3); }

        /* Dashboard Stats */
        .quick-stats, .referral-stats, .leadership-stats {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 24px; margin-bottom: 40px;
        }
        .stat-card {
            padding: 30px; display: flex; align-items: center; gap: 24px;
            transition: transform 0.3s ease, border-color 0.3s ease;
        }
        .stat-card:hover { transform: translateY(-5px); border-color: rgba(139, 92, 246, 0.4); background: var(--bg-card-hover); }
        
        .stat-icon {
            width: 64px; height: 64px; border-radius: 16px;
            background: linear-gradient(135deg, rgba(139,92,246,0.2), rgba(192,38,211,0.2));
            display: flex; align-items: center; justify-content: center;
            font-size: 1.75rem; color: #d8b4fe; border: 1px solid rgba(139,92,246,0.3);
            box-shadow: 0 0 15px rgba(139,92,246,0.15);
        }
        .stat-value { font-size: 1.75rem; font-weight: 700; margin-bottom: 4px; color: white; }
        .stat-label { color: var(--text-muted); font-size: 0.9rem; letter-spacing: 0.5px; text-transform: uppercase; }

        /* Investment History Section */
        .investment-history-container {
            padding: 30px;
            margin-top: 30px;
            display: none;
        }
        
        .investment-history-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(255,255,255,0.05);
        }
        
        .investment-history-list {
            max-height: 500px;
            overflow-y: auto;
        }
        
        .investment-history-item {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr 1fr;
            align-items: center;
            padding: 20px;
            margin-bottom: 15px;
            background: rgba(255,255,255,0.02);
            border-radius: 12px;
            border: 1px solid rgba(255,255,255,0.05);
            transition: all 0.3s ease;
            gap: 15px;
        }
        
        .investment-history-item:hover {
            background: rgba(139, 92, 246, 0.1);
            border-color: rgba(139, 92, 246, 0.3);
            transform: translateY(-2px);
        }
        
        .investment-plan {
            font-weight: 600;
            color: white;
        }
        
        .investment-amount {
            font-weight: 700;
            color: var(--primary-accent);
        }
        
        .investment-earned {
            font-weight: 600;
            color: #4ade80;
        }
        
        .investment-status {
            display: inline-flex;
            align-items: center;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .status-active {
            background: rgba(34, 197, 94, 0.15);
            color: #4ade80;
            border: 1px solid rgba(34, 197, 94, 0.3);
        }
        
        .status-completed {
            background: rgba(59, 130, 246, 0.15);
            color: #60a5fa;
            border: 1px solid rgba(59, 130, 246, 0.3);
        }
        
        .status-expired {
            background: rgba(107, 114, 128, 0.15);
            color: #9ca3af;
            border: 1px solid rgba(107, 114, 128, 0.3);
        }

        /* Investment Plans */
        .investment-plans { display: grid; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); gap: 30px; margin-bottom: 50px; }
        
        .plan-card {
            padding: 40px 30px; text-align: center; position: relative; transition: 0.4s ease;
            display: flex; flex-direction: column; height: 100%;
            background: linear-gradient(145deg, rgba(20, 15, 40, 0.6), rgba(10, 5, 20, 0.8));
        }
        .plan-card:hover { transform: translateY(-10px); border-color: var(--primary-accent); box-shadow: 0 10px 40px rgba(0,0,0,0.5); }
        
        .plan-card.featured {
            border: 1px solid rgba(217, 70, 239, 0.5);
            background: linear-gradient(145deg, rgba(40, 20, 60, 0.7), rgba(10, 5, 20, 0.9));
            transform: scale(1.05); z-index: 2;
        }
        .plan-card.featured:hover { transform: scale(1.05) translateY(-10px); }
        .plan-card.featured::before {
            content: 'MOST POPULAR'; position: absolute; top: -14px; left: 50%; transform: translateX(-50%);
            background: var(--gradient-main); padding: 6px 20px; border-radius: 20px;
            font-size: 0.75rem; font-weight: 700; letter-spacing: 1px; color: white;
            box-shadow: 0 5px 15px rgba(192, 38, 211, 0.4);
        }

        .plan-name { font-size: 1.5rem; margin-bottom: 15px; color: white; }
        .plan-roi { font-size: 2.5rem; font-weight: 700; margin-bottom: 20px; color: #d8b4fe; text-shadow: 0 0 15px rgba(139,92,246,0.3); }
        .plan-range { 
            background: rgba(255,255,255,0.05); padding: 12px; border-radius: 12px;
            margin-bottom: 25px; color: var(--text-muted); font-size: 0.9rem; border: 1px solid rgba(255,255,255,0.05);
        }
        .plan-features { list-style: none; margin-bottom: 30px; flex-grow: 1; text-align: left; padding-left: 10px; }
        .plan-features li { 
            margin-bottom: 12px; color: #cbd5e1; display: flex; align-items: center; gap: 10px; font-size: 0.95rem;
        }
        .plan-features li i { color: #4ade80; font-size: 0.8rem; }
        .plan-total { color: var(--secondary-accent); font-weight: 600; margin-bottom: 20px; font-size: 1.1rem; }

        /* Forms */
        .investment-form-container, .referral-link-container { max-width: 600px; margin: 0 auto 40px; padding: 40px; }
        .form-group label { display: block; margin-bottom: 10px; color: var(--text-muted); font-size: 0.9rem; }
        .form-input, .link-input {
            width: 100%; padding: 16px; border-radius: 12px;
            background: rgba(5, 2, 10, 0.6); border: 1px solid rgba(255,255,255,0.1);
            color: white; font-family: var(--font-body); font-size: 1rem;
            transition: 0.3s;
        }
        .form-input:focus, .link-input:focus { border-color: var(--primary-accent); box-shadow: 0 0 0 4px rgba(139, 92, 246, 0.1); }

        .plan-summary { background: rgba(139, 92, 246, 0.1); border: 1px solid rgba(139, 92, 246, 0.2); padding: 20px; border-radius: 12px; margin-bottom: 20px; }

        /* Timer & Action Buttons */
        .action-buttons { display: flex; justify-content: center; gap: 16px; margin-bottom: 40px; flex-wrap: wrap; }
        
        .timer-container {
            display: inline-flex; flex-direction: column; align-items: center;
            background: rgba(0,0,0,0.3); padding: 12px 24px; border-radius: 16px;
            border: 1px solid rgba(255,255,255,0.05);
        }
        .timer-display { display: flex; align-items: center; gap: 8px; font-family: var(--font-heading); font-size: 1.5rem; color: var(--secondary-accent); font-weight: 700; }
        .timer-value { min-width: 36px; text-align: center; }
        .timer-label { font-size: 0.75rem; color: var(--text-muted); margin-bottom: 4px; text-transform: uppercase; letter-spacing: 1px; }

        /* Alerts & States */
        .alert {
            padding: 20px; border-radius: 16px; display: flex; align-items: center; gap: 16px;
            max-width: 800px; margin: 0 auto 30px; font-size: 0.95rem;
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border: var(--glass-border);
            box-shadow: var(--shadow-card);
            transition: all 0.3s ease;
        }
        .alert-warning { 
            background: rgba(245, 158, 11, 0.1); 
            border-color: rgba(245, 158, 11, 0.3); 
            color: #fbbf24; 
        }
        .alert-success { 
            background: rgba(34, 197, 94, 0.1); 
            border-color: rgba(34, 197, 94, 0.3); 
            color: #4ade80; 
        }
        .alert-info { 
            background: rgba(59, 130, 246, 0.1); 
            border-color: rgba(59, 130, 246, 0.3); 
            color: #60a5fa; 
        }
        .alert-error { 
            background: rgba(239, 68, 68, 0.1); 
            border-color: rgba(239, 68, 68, 0.3); 
            color: #f87171; 
        }
        
        .empty-state { text-align: center; padding: 60px 20px; }
        .empty-icon { font-size: 3rem; color: rgba(255,255,255,0.2); margin-bottom: 20px; }

        /* Team Members */
        .team-members-container {
            padding: 30px;
            margin-top: 30px;
        }
        
        .team-members-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(255,255,255,0.05);
        }
        
        .team-members-list {
            max-height: 400px;
            overflow-y: auto;
        }
        
        .team-member-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            margin-bottom: 10px;
            background: rgba(255,255,255,0.02);
            border-radius: 12px;
            border: 1px solid rgba(255,255,255,0.05);
            transition: all 0.3s ease;
        }
        
        .team-member-item:hover {
            background: rgba(139, 92, 246, 0.1);
            border-color: rgba(139, 92, 246, 0.3);
        }
        
        .member-address {
            font-family: monospace;
            font-size: 0.9rem;
        }
        
        .member-level {
            background: var(--gradient-main);
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }
        
        .member-investment {
            color: var(--text-muted);
            font-size: 0.9rem;
        }

        /* Popups & Notifications */
        .investment-success-popup {
            position: fixed; inset: 0; background: rgba(0,0,0,0.8);
            backdrop-filter: blur(8px); z-index: 2000;
            display: flex; justify-content: center; align-items: center;
            opacity: 0; visibility: hidden; transition: 0.3s;
        }
        .investment-success-popup.active { opacity: 1; visibility: visible; }
        .investment-success { max-width: 450px; width: 90%; padding: 40px; text-align: center; transform: scale(0.9); transition: 0.3s; }
        .investment-success-popup.active .investment-success { transform: scale(1); }
        
        .success-icon {
            width: 80px; height: 80px; background: var(--gradient-main); border-radius: 50%;
            display: flex; align-items: center; justify-content: center; font-size: 2rem; color: white;
            margin: 0 auto 24px; box-shadow: 0 0 30px rgba(192, 38, 211, 0.5);
        }

        .notification {
            position: fixed; top: 100px; right: 20px; padding: 16px 24px;
            background: rgba(15, 23, 42, 0.9); border: 1px solid rgba(255,255,255,0.1);
            color: white; border-radius: 12px; z-index: 3000;
            transform: translateX(120%); transition: transform 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            backdrop-filter: blur(10px); box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            display: flex; align-items: center; gap: 10px;
            max-width: 400px;
        }
        .notification.show { transform: translateX(0); }
        .notification.success { 
            border-left: 4px solid #4ade80;
            background: rgba(15, 23, 42, 0.95);
        }
        .notification.error { 
            border-left: 4px solid #ef4444;
            background: rgba(15, 23, 42, 0.95);
        }
        .notification.info { 
            border-left: 4px solid #60a5fa;
            background: rgba(15, 23, 42, 0.95);
        }
        .notification.warning { 
            border-left: 4px solid #fbbf24;
            background: rgba(15, 23, 42, 0.95);
        }

        /* Referral Levels Compact */
        .referral-levels-compact, .leadership-levels-compact { display: grid; grid-template-columns: repeat(auto-fill, minmax(130px, 1fr)); gap: 16px; margin-bottom: 40px; }
        .referral-level-compact, .leadership-level-compact { 
            padding: 16px; text-align: center; transition: 0.3s;
            background: rgba(255,255,255,0.02);
        }
        .referral-level-compact:hover { background: rgba(139, 92, 246, 0.1); border-color: rgba(139, 92, 246, 0.3); }
        
        .level-number-compact {
            width: 32px; height: 32px; background: rgba(255,255,255,0.1); border-radius: 50%;
            display: flex; align-items: center; justify-content: center; margin: 0 auto 10px;
            font-size: 0.8rem; font-weight: 700; color: var(--primary-accent);
        }
        .level-commission-compact { color: white; font-weight: 700; font-size: 1.2rem; }
        .level-requirement-compact { font-size: 0.75rem; color: var(--text-muted); margin-top: 4px; }

        /* FAQ */
        .faq-item { margin-bottom: 16px; overflow: hidden; transition: 0.3s; }
        .faq-item:hover { border-color: rgba(139, 92, 246, 0.3); }
        .faq-question { padding: 24px; cursor: pointer; display: flex; justify-content: space-between; align-items: center; }
        .faq-question h3 { font-size: 1.05rem; font-weight: 600; margin: 0; }
        .faq-icon { transition: 0.3s; color: var(--primary-accent); }
        .faq-answer { 
            max-height: 0; overflow: hidden; transition: 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            padding: 0 24px; color: var(--text-muted); line-height: 1.7;
        }
        .faq-item.active .faq-answer { padding-bottom: 24px; max-height: 500px; }
        .faq-item.active .faq-icon { transform: rotate(180deg); }

        /* Footer */
        .footer { border-top: 1px solid rgba(255,255,255,0.05); padding: 80px 0 30px; background: #02010a; margin-top: auto; }
        .footer__logo { display: flex; align-items: center; gap: 10px; margin-bottom: 20px; justify-content: center; }
        .footer__logo span { font-size: 1.5rem; font-weight: 700; font-family: var(--font-heading); color: white; }
        .footer__social { display: flex; gap: 16px; margin-top: 30px; justify-content: center; }
        .social__link {
            width: 44px; height: 44px; border-radius: 12px; background: rgba(255,255,255,0.05);
            display: flex; align-items: center; justify-content: center; color: white;
            transition: 0.3s; border: 1px solid rgba(255,255,255,0.05); text-decoration: none;
        }
        .social__link:hover { background: var(--primary-accent); transform: translateY(-3px); box-shadow: 0 5px 15px rgba(124, 58, 237, 0.4); }
        .footer__bottom { margin-top: 60px; padding-top: 30px; border-top: 1px solid rgba(255,255,255,0.05); text-align: center; color: rgba(255,255,255,0.3); font-size: 0.9rem; }

        /* Responsive */
        @media (max-width: 968px) {
            .hero__container { grid-template-columns: 1fr; text-align: center; gap: 40px; }
            .hero__content { display: flex; flex-direction: column; align-items: center; }
            .hero__title { font-size: 3rem; }
            .hero__buttons { justify-content: center; }
            .investment-history-item {
                grid-template-columns: 1fr 1fr;
                gap: 10px;
            }
        }
        
        @media (max-width: 768px) {
            .nav__menu {
                position: fixed; top: 70px; left: -100%; width: 100%; height: calc(100vh - 70px);
                background: #030014; flex-direction: column; padding: 40px;
                transition: 0.4s; align-items: flex-start; border-top: 1px solid rgba(255,255,255,0.05);
            }
            .nav__menu.active { left: 0; }
            .nav__list { flex-direction: column; gap: 20px; width: 100%; margin-bottom: 30px; }
            .nav__toggle { display: block; }
            .section__title { font-size: 2.5rem; }
            .hero__title { font-size: 2.5rem; }
            .hero__description { font-size: 1.1rem; }
            .investment-history-item {
                grid-template-columns: 1fr;
                text-align: center;
            }
        }

        @media (max-width: 480px) {
            .hero__title { font-size: 2rem; }
            .hero__buttons { flex-direction: column; width: 100%; }
            .hero__buttons .btn { width: 100%; }
            .section { padding: 80px 0; }
            .section__title { font-size: 2rem; }
        }
    </style>
</head>
<body>
    <!-- Preloader -->
    <div class="preloader">
        <div class="loader">
            <div class="purple-bar"></div>
            <div class="purple-bar"></div>
            <div class="purple-bar"></div>
            <div class="purple-bar"></div>
            <div class="purple-bar"></div>
        </div>
        <div class="preloader-text">NEXAGON</div>
    </div>

    <!-- Header -->
    <header class="header">
        <nav class="nav container">
            <a href="#" class="nav__logo">
                <img src="image/logo.png" alt="N" class="logo">
                <div class="logo__text">NEXAGON</div>
            </a>

            <div class="nav__menu" id="nav-menu">
                <ul class="nav__list">
                    <li class="nav__item"><a class="nav__link active" data-section="home">Home</a></li>
                    <li class="nav__item"><a class="nav__link" data-section="dashboard">Dashboard</a></li>
                    <li class="nav__item"><a class="nav__link" data-section="invest">Invest</a></li>
                    <li class="nav__item"><a class="nav__link" data-section="referral">Referral</a></li>
                    <li class="nav__item"><a class="nav__link" data-section="leadership">Leadership</a></li>
                    <li class="nav__item"><a class="nav__link" data-section="faq">FAQ</a></li>
                </ul>

                <button class="btn btn--outline btn-sm" id="connectWallet">
                    <i class="fas fa-wallet"></i>
                    Connect Wallet
                </button>
            </div>

            <div class="nav__toggle" id="nav-toggle">
                <i class="fas fa-bars"></i>
            </div>
        </nav>
    </header>

    <!-- Main Content -->
    <main class="main">
        <!-- Home Section -->
        <section class="hero section" id="home">
            <div class="hero__container container">
                <div class="hero__content">
                    <div class="badge">
                        <i class="fas fa-bolt"></i> Advanced DeFi Protocol
                    </div>
                    <h1 class="hero__title">
                        Grow Wealth with <br>
                        <span class="gradient-text">Nexagon Protocol</span>
                    </h1>
                    <p class="hero__description">
                        Earn stable daily returns through our optimized ROI system, backed by a 15-level referral program and secure smart contract technology
                    </p>
                    <div class="hero__buttons">
                        <button class="btn btn--primary btn-lg" data-section="invest">
                            <i class="fas fa-rocket"></i>
                            Start Investing
                        </button>
                        <button class="btn btn--outline btn-lg" data-section="dashboard">
                            <i class="fas fa-chart-line"></i>
                            View Dashboard
                        </button>
                    </div>
                </div>
                <div class="hero__image">
                    <div class="floating-card">
                        <div class="card__header">
                            <h3>Live Contract</h3>
                            <div class="live-indicator">
                                <span class="dot"></span>
                                LIVE
                            </div>
                        </div>
                        <div class="card__content">
                            <div class="stat-item">
                                <span class="label">TVL</span>
                                <span class="value" id="statTvl">Loading...</span>
                            </div>
                            <div class="stat-item">
                                <span class="label">Total Users</span>
                                <span class="value" id="statTotalUsers">Loading...</span>
                            </div>
                            <div class="stat-item">
                                <span class="label">Total Deposit</span>
                                <span class="value" id="statTotalDeposit">Loading...</span>
                            </div>
                            <div class="stat-item">
                                <span class="label">Total Paid Out</span>
                                <span class="value" id="statTotalPaidOut">Loading...</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Dashboard Section -->
        <section class="section" id="dashboard" style="display: none;">
            <div class="container">
                <div class="section__header">
                    <h2 class="section__title">Your Dashboard</h2>
                    <p class="section__subtitle">Monitor your investments and earnings in real-time</p>
                </div>

                <div class="alert alert-warning" id="dashboardWalletAlert">
                    <i class="fas fa-exclamation-triangle"></i>
                    <span>Please connect your wallet to view your dashboard</span>
                </div>

                <div class="quick-stats" id="quickStats" style="display: none;">
                    <div class="stat-card">
                        <div class="stat-icon"><i class="fas fa-wallet"></i></div>
                        <div class="stat-info">
                            <div class="stat-value" id="totalInvested">0 USDT</div>
                            <div class="stat-label">Total Invested</div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon"><i class="fas fa-chart-line"></i></div>
                        <div class="stat-info">
                            <div class="stat-value" id="pendingRewards">0 USDT</div>
                            <div class="stat-label">Pending Rewards</div>
                        </div>
                    </div>
                </div>

                <div class="action-buttons" id="actionButtons" style="display: none;">
                    <button class="btn btn--primary" data-section="invest">
                        <i class="fas fa-rocket"></i> Start Investing
                    </button>
                    <button class="btn btn--outline" id="withdrawROI">
                        <i class="fas fa-download"></i> Withdraw ROI
                    </button>
                    <!-- Timer Container -->
                    <div class="timer-container" id="withdrawTimer" style="display: none;">
                        <div class="timer-label">Next Withdrawal In</div>
                        <div class="timer-display">
                            <div class="timer-unit"><div class="timer-value" id="timerHours">00</div></div>
                            :
                            <div class="timer-unit"><div class="timer-value" id="timerMinutes">00</div></div>
                            :
                            <div class="timer-unit"><div class="timer-value" id="timerSeconds">00</div></div>
                        </div>
                    </div>
                </div>
                
                <div class="empty-state" id="noInvestmentsMessage" style="display: none;">
                    <div class="empty-icon"><i class="fas fa-chart-pie"></i></div>
                    <h3>No Active Investments</h3>
                    <p style="color: var(--text-muted); margin-bottom: 20px;">Start your first investment to begin earning premium returns</p>
                    <button class="btn btn--primary" data-section="invest">
                        <i class="fas fa-rocket"></i> Start Investing
                    </button>
                </div>

                <!-- My Investment History Section -->
                <div class="investment-history-container" id="investmentHistoryContainer">
                    <div class="investment-history-header">
                        <h3 style="margin: 0;">My Investment History</h3>
                        <div class="investment-summary">
                            <span style="color: var(--text-muted);">Total Investments: </span>
                            <span id="totalInvestmentsCount" style="font-weight: 600; color: white;">0</span>
                        </div>
                    </div>
                    
                    <div class="investment-history-list" id="investmentHistoryList">
                        <!-- Investment history items will be populated here -->
                    </div>
                    
                    <div class="empty-state" id="noInvestmentHistory" style="display: none; padding: 40px 20px;">
                        <div class="empty-icon"><i class="fas fa-history"></i></div>
                        <h3>No Investment History</h3>
                        <p style="color: var(--text-muted); margin-bottom: 20px;">Your investment history will appear here once you make your first investment</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Invest Section -->
        <section class="section" id="invest" style="display: none;">
            <div class="container">
                <div class="section__header">
                    <h2 class="section__title">Investment Plans</h2>
                    <p class="section__subtitle">Choose a plan that suits your financial goals</p>
                </div>

                <div class="alert alert-warning" id="investWalletAlert">
                    <i class="fas fa-exclamation-triangle"></i>
                    <span>Please connect your wallet to start investing</span>
                </div>

                <div class="investment-plans" id="investmentPlans">
                    <!-- JS Generated -->
                </div>

                <div class="investment-form-container" id="investmentForm" style="display: none;">
                    <div class="card__header">
                        <h2>Complete Investment</h2>
                        <button class="btn btn--outline btn-sm" id="backToPlans">
                            <i class="fas fa-arrow-left"></i> Back
                        </button>
                    </div>

                    <div class="investment-form">
                        <div class="form-group" style="margin-bottom: 20px;">
                            <label>Selected Plan</label>
                            <div class="plan-summary" id="selectedPlanSummary"></div>
                        </div>

                        <div class="form-group" style="margin-bottom: 20px;">
                            <label for="investmentAmount">Investment Amount (USDT)</label>
                            <input type="number" id="investmentAmount" class="form-input" placeholder="0.00" min="10" step="1">
                            <div class="amount-range" id="amountRange" style="font-size: 0.8rem; color: var(--text-muted); margin-top: 6px;"></div>
                        </div>

                        <div class="form-group" style="margin-bottom: 30px;">
                            <label for="referrerAddress">Referrer Address (Optional)</label>
                            <input type="text" id="referrerAddress" class="form-input" placeholder="0x...">
                        </div>

                        <button class="btn btn--primary btn-lg" id="confirmInvestment" style="width: 100%;">
                            <i class="fas fa-check-circle"></i> Confirm
                        </button>
                    </div>
                </div>

                <div class="investment-success-popup" id="investmentSuccessPopup">
                    <div class="investment-success">
                        <div class="success-icon"><i class="fas fa-crown"></i></div>
                        <h2 style="margin-bottom: 10px;">Investment Successful!</h2>
                        <p style="color: var(--text-muted); margin-bottom: 30px;">You can now monitor your earnings</p>
                        <div class="success-actions" style="display: flex; gap: 10px; justify-content: center;">
                            <button class="btn btn--primary" data-section="dashboard">Go to Dashboard</button>
                            <button class="btn btn--outline" id="newInvestment">New Investment</button>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Referral Section -->
        <section class="section" id="referral" style="display: none;">
            <div class="container">
                <div class="section__header">
                    <h2 class="section__title">Referral Program</h2>
                    <p class="section__subtitle">Earn commissions from your 15 levels of network</p>
                </div>

                <div class="alert alert-warning" id="referralWalletAlert">
                    <i class="fas fa-exclamation-triangle"></i>
                    <span>Please connect your wallet to access referral program</span>
                </div>

                <div class="referral-stats" id="referralStats" style="display: none;">
                    <div class="stat-card">
                        <div class="stat-icon"><i class="fas fa-gift"></i></div>
                        <div class="stat-info">
                            <div class="stat-value" id="referralBonusAmount">0 USDT</div>
                            <div class="stat-label">Referral Earnings</div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon"><i class="fas fa-layer-group"></i></div>
                        <div class="stat-info">
                            <div class="stat-value" id="referralLevel">0</div>
                            <div class="stat-label">Current Level</div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon"><i class="fas fa-users"></i></div>
                        <div class="stat-info">
                            <div class="stat-value" id="referralTeamCount">0</div>
                            <div class="stat-label">Team Members</div>
                        </div>
                    </div>
                </div>

                <div class="action-buttons" id="referralActionButtons" style="display: none;">
                    <button class="btn btn--outline" id="withdrawReferral">
                        <i class="fas fa-download"></i> Withdraw Referral
                    </button>
                </div>

                <div class="referral-link-container" id="referralLinkSection" style="display: none; text-align: center;">
                    <h2 style="margin-bottom: 10px; font-size: 1.5rem;">Your Referral Link</h2>
                    <p style="color: var(--text-muted); margin-bottom: 20px;">Share this link to grow your network</p>
                    <div style="display: flex; gap: 10px; margin-bottom: 20px;">
                        <input type="text" id="referralLink" class="link-input" readonly style="flex: 1;">
                    </div>
                    <!-- Button copy dipindahkan ke bawah link dan di tengah -->
                    <div style="display: flex; justify-content: center; margin-bottom: 20px;">
                        <button class="btn btn--primary" id="copyLink" style="padding: 12px 28px; font-size: 0.95rem;">
                            <i class="fas fa-copy"></i> Copy
                        </button>
                    </div>
                    <div class="social-share" style="justify-content: center; display: flex; gap: 10px;">
                        <button class="btn btn--outline btn-sm" id="shareTelegram"><i class="fab fa-telegram"></i></button>
                        <button class="btn btn--outline btn-sm" id="shareTwitter"><i class="fab fa-twitter"></i></button>
                        <button class="btn btn--outline btn-sm" id="shareWhatsapp"><i class="fab fa-whatsapp"></i></button>
                    </div>
                </div>

                <div class="referral-levels-compact" id="referralLevelsCompact">
                    <!-- JS Generated -->
                </div>
            </div>
        </section>

        <!-- Leadership Section -->
        <section class="section" id="leadership" style="display: none;">
            <div class="container">
                <div class="section__header">
                    <h2 class="section__title">Leadership Program</h2>
                    <p class="section__subtitle">Unlock leadership bonuses by building a strong team</p>
                </div>

                <div class="alert alert-warning" id="leadershipWalletAlert">
                    <i class="fas fa-exclamation-triangle"></i>
                    <span>Please connect your wallet to view leadership program</span>
                </div>

                <div class="leadership-stats" id="leadershipStats" style="display: none;">
                    <div class="stat-card">
                        <div class="stat-icon"><i class="fas fa-crown"></i></div>
                        <div class="stat-info">
                            <div class="stat-value" id="leadershipBonusStats">0 USDT</div>
                            <div class="stat-label">Leadership Earnings</div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon"><i class="fas fa-layer-group"></i></div>
                        <div class="stat-info">
                            <div class="stat-value" id="currentLeadershipLevel">0</div>
                            <div class="stat-label">Current Level</div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon"><i class="fas fa-users"></i></div>
                        <div class="stat-info">
                            <div class="stat-value" id="leadershipTeamCount">0</div>
                            <div class="stat-label">Team Members</div>
                        </div>
                    </div>
                </div>

                <div class="action-buttons" id="leadershipActionButtons" style="display: none;">
                    <button class="btn btn--outline" id="withdrawLeadership">
                        <i class="fas fa-download"></i> Withdraw Leadership
                    </button>
                </div>

                <div class="leadership-levels-compact" id="leadershipLevelsCompact">
                    <!-- JS Generated -->
                </div>
            </div>
        </section>

        <!-- FAQ Section -->
        <section class="section" id="faq" style="display: none;">
            <div class="container" style="max-width: 800px;">
                <div class="section__header">
                    <h2 class="section__title">Frequently Asked Questions</h2>
                    <p class="section__subtitle">Find answers to common questions about Nexagon</p>
                </div>

                <div class="faq-container">
                    <div class="faq-item">
                        <div class="faq-question">
                            <h3>How does the investment process work?</h3>
                            <i class="fas fa-chevron-down faq-icon"></i>
                        </div>
                        <div class="faq-answer">
                            <p>To start investing, connect your wallet, choose an investment plan, deposit USDT, and begin earning daily returns. Your earnings are calculated and available for withdrawal every 8 hours.</p>
                        </div>
                    </div>

                    <div class="faq-item">
                        <div class="faq-question">
                            <h3>What are the minimum and maximum investment amounts?</h3>
                            <i class="fas fa-chevron-down faq-icon"></i>
                        </div>
                        <div class="faq-answer">
                            <p>The minimum investment varies by plan: Gold Plan: 10-100 USDT, Platinum Plan: 50-100 USDT, Diamond Plan: 100+ USDT with no maximum limit.</p>
                        </div>
                    </div>

                    <div class="faq-item">
                        <div class="faq-question">
                            <h3>How are daily returns calculated?</h3>
                            <i class="fas fa-chevron-down faq-icon"></i>
                        </div>
                        <div class="faq-answer">
                            <p>Daily returns are calculated based on your investment amount and the daily ROI rate of your chosen plan. Gold Plan: 16% daily, Platinum Plan: 9% daily, Diamond Plan: 5% daily.</p>
                        </div>
                    </div>

                    <div class="faq-item">
                        <div class="faq-question">
                            <h3>How does the referral program work?</h3>
                            <i class="fas fa-chevron-down faq-icon"></i>
                        </div>
                        <div class="faq-answer">
                            <p>Our referral program has 15 levels with varying commission rates from 15% down to 1%. You earn commissions from your referrals' investments based on your total investment amount and level requirements.</p>
                        </div>
                    </div>

                    <div class="faq-item">
                        <div class="faq-question">
                            <h3>How does the leadership program work?</h3>
                            <i class="fas fa-chevron-down faq-icon"></i>
                        </div>
                        <div class="faq-answer">
                            <p>The leadership program rewards you for building an active team. With 3 levels requiring 200, 500, and 1000 active team members, you can earn additional bonuses of 3%, 7%, and 10% respectively from your team's ROI withdrawals.</p>
                        </div>
                    </div>

                    <div class="faq-item">
                        <div class="faq-question">
                            <h3>Is there a withdrawal fee?</h3>
                            <i class="fas fa-chevron-down faq-icon"></i>
                        </div>
                        <div class="faq-answer">
                            <p>No, there are no withdrawal fees for ROI or referral earnings. The contract only deducts a 10% owner fee from deposits to maintain platform operations.</p>
                        </div>
                    </div>

                    <div class="faq-item">
                        <div class="faq-question">
                            <h3>How secure is Nexagon?</h3>
                            <i class="fas fa-chevron-down faq-icon"></i>
                        </div>
                        <div class="faq-answer">
                            <p>Nexagon uses audited smart contracts on the Binance Smart Chain. Our contracts have been verified and implement multiple security measures including reentrancy protection to protect user funds.</p>
                        </div>
                    </div>

                    <div class="faq-item">
                        <div class="faq-question">
                            <h3>What happens if I refer someone but don't meet the requirements for higher levels?</h3>
                            <i class="fas fa-chevron-down faq-icon"></i>
                        </div>
                        <div class="faq-answer">
                            <p>If you don't meet the minimum investment requirements for higher referral levels, the corresponding referral bonus will expire and be added to the expired contract balance, which is used for platform maintenance and development.</p>
                        </div>
                    </div>

                    <div class="faq-item">
                        <div class="faq-question">
                            <h3>Can I have multiple active investments at the same time?</h3>
                            <i class="fas fa-chevron-down faq-icon"></i>
                        </div>
                        <div class="faq-answer">
                            <p>Yes, you can have multiple active investments across different plans simultaneously. Each investment is tracked separately with its own ROI calculation and duration.</p>
                        </div>
                    </div>

                    <div class="faq-item">
                        <div class="faq-question">
                            <h3>What happens when an investment plan ends?</h3>
                            <i class="fas fa-chevron-down faq-icon"></i>
                        </div>
                        <div class="faq-answer">
                            <p>When an investment plan reaches its duration, it becomes inactive and stops generating returns. You can then withdraw any remaining rewards and start a new investment if desired.</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer__content" style="text-align: center;">
                <div class="footer__brand">
                    <div class="footer__logo">
                        <img src="image/logo.png" alt="Nexagon" class="logo" style="width: 30px; height: 30px;">
                        <span>Nexagon</span>
                    </div>
                    <p style="color: var(--text-muted); max-width: 500px; margin: 0 auto; line-height: 1.6;">
                        Earn stable daily returns through our optimized ROI system, backed by a 15-level referral program and secure smart contract technology
                    </p>
                    <div class="footer__social">
                        <a href="https://t.me/NexagonNews" class="social__link"><i class="fab fa-telegram-plane"></i></a>
                        <a href="https://x.com/NexagonDeFi" class="social__link"><i class="fab fa-twitter"></i></a>
                        <a href="https://bscscan.com/address/0x86f6A9d479590A5fB1908811e34f98Ec5D9d97bb#code" class="social__link"><i class="fas fa-file-contract"></i></a>
                    </div>
                </div>
            </div>
            <div class="footer__bottom">
                <p>&copy; 2025 Nexagon</p>
            </div>
        </div>
    </footer>

    <!-- Notification -->
    <div class="notification" id="notification"></div>

    <script>
        // Updated contract address and ABI
        const CONTRACT_ADDRESS = '0x86f6A9d479590A5fB1908811e34f98Ec5D9d97bb';
        const USDT_ADDRESS = '0x55d398326f99059fF775485246999027B3197955';
        const READ_ONLY_RPC = 'https://bsc-dataseed1.binance.org/';
        
        const USDT_ABI = [
            {"constant": false, "inputs": [{"name": "_spender", "type": "address"}, {"name": "_value", "type": "uint256"}], "name": "approve", "outputs": [{"name": "", "type": "bool"}], "type": "function"}, 
            {"constant": true, "inputs": [{"name": "_owner", "type": "address"}], "name": "balanceOf", "outputs": [{"name": "balance", "type": "uint256"}], "type": "function"}, 
            {"constant": true, "inputs": [{"name": "_owner", "type": "address"}, {"name": "_spender", "type": "address"}], "name": "allowance", "outputs": [{"name": "", "type": "uint256"}], "type": "function"}, 
            {"constant": true, "inputs": [], "name": "decimals", "outputs": [{"name": "", "type": "uint8"}], "type": "function"}
        ];
        
        const CONTRACT_ABI = [{"inputs":[{"internalType":"address","name":"_usdtAddress","type":"address"}],"stateMutability":"nonpayable","type":"constructor"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"leader","type":"address"},{"indexed":false,"internalType":"uint256","name":"level","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"amount","type":"uint256"}],"name":"LeadershipBonusAdded","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"user","type":"address"},{"indexed":false,"internalType":"uint256","name":"planId","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"amount","type":"uint256"},{"indexed":false,"internalType":"address","name":"referrer","type":"address"}],"name":"NewDeposit","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"previousOwner","type":"address"},{"indexed":true,"internalType":"address","name":"newOwner","type":"address"}],"name":"OwnershipTransferred","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"referrer","type":"address"},{"indexed":true,"internalType":"address","name":"user","type":"address"},{"indexed":false,"internalType":"uint256","name":"level","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"amount","type":"uint256"}],"name":"ReferralBonusAdded","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"owner","type":"address"},{"indexed":false,"internalType":"uint256","name":"amount","type":"uint256"}],"name":"ReferralExpiredWithdrawn","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"uint256","name":"timestamp","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"processedAmount","type":"uint256"}],"name":"SystemMetricsUpdated","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"user","type":"address"},{"indexed":false,"internalType":"uint256","name":"amount","type":"uint256"}],"name":"WithdrawLeadership","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"user","type":"address"},{"indexed":false,"internalType":"uint256","name":"amount","type":"uint256"}],"name":"WithdrawROI","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"user","type":"address"},{"indexed":false,"internalType":"uint256","name":"amount","type":"uint256"}],"name":"WithdrawReferral","type":"event"},{"inputs":[],"name":"CLAIM_COOLDOWN","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"PERCENTS_DIVIDER","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"ReferralExpired","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"TIME_STEP","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"USDT","outputs":[{"internalType":"contract IERC20","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"","type":"uint256"}],"name":"allUsers","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"_user","type":"address"},{"internalType":"uint256","name":"_investmentIndex","type":"uint256"}],"name":"calculateRewards","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"getContractBalance","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"_user","type":"address"}],"name":"getDirectReferrals","outputs":[{"internalType":"address[]","name":"","type":"address[]"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"getLeadershipRates","outputs":[{"internalType":"uint256[3]","name":"","type":"uint256[3]"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"getLeadershipRequirements","outputs":[{"internalType":"uint256[3]","name":"","type":"uint256[3]"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"_user","type":"address"}],"name":"getNextWithdrawTime","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"_user","type":"address"}],"name":"getPendingRewards","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"_planId","type":"uint256"}],"name":"getPlanInfo","outputs":[{"internalType":"uint256","name":"minDeposit","type":"uint256"},{"internalType":"uint256","name":"maxDeposit","type":"uint256"},{"internalType":"uint256","name":"dailyROI","type":"uint256"},{"internalType":"uint256","name":"duration","type":"uint256"},{"internalType":"uint256","name":"totalReturn","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"getPlatformStats","outputs":[{"internalType":"uint256","name":"contractBalance","type":"uint256"},{"internalType":"uint256","name":"totalInvestors_","type":"uint256"},{"internalType":"uint256","name":"totalInvested_","type":"uint256"},{"internalType":"uint256","name":"totalWithdrawn_","type":"uint256"},{"internalType":"uint256","name":"totalReferralBonus_","type":"uint256"},{"internalType":"uint256","name":"totalLeadershipBonus_","type":"uint256"},{"internalType":"uint256","name":"referralExpiredBalance_","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"getReferralRates","outputs":[{"internalType":"uint256[15]","name":"","type":"uint256[15]"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"getReferralRequirements","outputs":[{"internalType":"uint256[15]","name":"","type":"uint256[15]"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"_user","type":"address"},{"internalType":"uint256","name":"_level","type":"uint256"}],"name":"getReferralsCountByLevel","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"_user","type":"address"}],"name":"getTeamMembers","outputs":[{"internalType":"address[]","name":"teamAddresses","type":"address[]"},{"internalType":"uint256[]","name":"investmentAmounts","type":"uint256[]"},{"internalType":"uint256[]","name":"activeStatus","type":"uint256[]"},{"internalType":"uint256","name":"totalTeamMembers","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"_user","type":"address"},{"internalType":"uint256","name":"_level","type":"uint256"}],"name":"getTeamMembersByLevel","outputs":[{"internalType":"address[]","name":"","type":"address[]"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"_user","type":"address"}],"name":"getTeamMembersCount","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"getTotalInvest","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"getTotalPaidOut","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"_user","type":"address"}],"name":"getTotalTeamSize","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"getTotalUser","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"_user","type":"address"}],"name":"getUserInfo","outputs":[{"internalType":"uint256","name":"totalInvested","type":"uint256"},{"internalType":"uint256","name":"totalWithdrawn","type":"uint256"},{"internalType":"uint256","name":"activeInvestments","type":"uint256"},{"internalType":"uint256","name":"referralBonus","type":"uint256"},{"internalType":"uint256","name":"referralBonusWithdrawn","type":"uint256"},{"internalType":"uint256","name":"leadershipBonus","type":"uint256"},{"internalType":"uint256","name":"leadershipBonusWithdrawn","type":"uint256"},{"internalType":"address","name":"referrer","type":"address"},{"internalType":"uint256[15]","name":"referralLevels","type":"uint256[15]"},{"internalType":"uint256[3]","name":"leadershipLevels","type":"uint256[3]"},{"internalType":"uint256","name":"directReferrals","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"_user","type":"address"}],"name":"getUserInvestments","outputs":[{"internalType":"uint256[]","name":"planIds","type":"uint256[]"},{"internalType":"uint256[]","name":"amounts","type":"uint256[]"},{"internalType":"uint256[]","name":"startTimes","type":"uint256[]"},{"internalType":"uint256[]","name":"lastClaimTimes","type":"uint256[]"},{"internalType":"uint256[]","name":"totalClaimeds","type":"uint256[]"},{"internalType":"bool[]","name":"actives","type":"bool[]"},{"internalType":"uint256[]","name":"pendingRewards","type":"uint256[]"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"","type":"address"}],"name":"hasActiveDeposit","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"_planId","type":"uint256"},{"internalType":"uint256","name":"_amount","type":"uint256"},{"internalType":"address","name":"_referrer","type":"address"}],"name":"invest","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"","type":"uint256"}],"name":"leadershipRates","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"","type":"uint256"}],"name":"leadershipRequirements","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"owner","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"","type":"uint256"}],"name":"plans","outputs":[{"internalType":"uint256","name":"minDeposit","type":"uint256"},{"internalType":"uint256","name":"maxDeposit","type":"uint256"},{"internalType":"uint256","name":"dailyROI","type":"uint256"},{"internalType":"uint256","name":"duration","type":"uint256"},{"internalType":"uint256","name":"totalReturn","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"referralExpiredBalance","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"","type":"uint256"}],"name":"referralRates","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"","type":"uint256"}],"name":"referralRequirements","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"totalInvested","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"totalInvestors","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"totalLeadershipBonus","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"totalReferralBonus","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"totalWithdrawn","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"","type":"address"},{"internalType":"uint256","name":"","type":"uint256"}],"name":"userLevels","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"","type":"address"},{"internalType":"uint256","name":"","type":"uint256"}],"name":"userReferrals","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"","type":"address"}],"name":"users","outputs":[{"internalType":"address","name":"referrer","type":"address"},{"internalType":"uint256","name":"totalInvested","type":"uint256"},{"internalType":"uint256","name":"totalWithdrawn","type":"uint256"},{"internalType":"uint256","name":"referralBonus","type":"uint256"},{"internalType":"uint256","name":"referralBonusWithdrawn","type":"uint256"},{"internalType":"uint256","name":"leadershipBonus","type":"uint256"},{"internalType":"uint256","name":"leadershipBonusWithdrawn","type":"uint256"},{"internalType":"bool","name":"registered","type":"bool"},{"internalType":"uint256","name":"directReferrals","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"withdrawLeadership","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"withdrawROI","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"withdrawReferral","outputs":[],"stateMutability":"nonpayable","type":"function"}];

        let web3;
        let contract;
        let usdtContract;
        let userAccount;
        let selectedPlan = null;
        let referralAddress = null;
        let withdrawTimerInterval = null;

        const preloader = document.querySelector('.preloader');
        const navMenu = document.getElementById('nav-menu');
        const navToggle = document.getElementById('nav-toggle');
        const connectWalletBtn = document.getElementById('connectWallet');
        const notification = document.getElementById('notification');
        const investmentSuccessPopup = document.getElementById('investmentSuccessPopup');

        const sections = {
            home: document.getElementById('home'),
            dashboard: document.getElementById('dashboard'),
            invest: document.getElementById('invest'),
            referral: document.getElementById('referral'),
            leadership: document.getElementById('leadership'),
            faq: document.getElementById('faq')
        };

        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
            setupEventListeners();
            generateInvestmentPlans();
            checkPreloader();
            checkURLForReferral();
            setupFAQ();
            generateReferralLevelsCompact(); 
            generateLeadershipLevelsCompact(); 
        });

        function setupFAQ() {
            const faqItems = document.querySelectorAll('.faq-item');
            faqItems.forEach(item => {
                const question = item.querySelector('.faq-question');
                question.addEventListener('click', () => {
                    const isActive = item.classList.contains('active');
                    faqItems.forEach(otherItem => otherItem.classList.remove('active'));
                    if (!isActive) item.classList.add('active');
                });
            });
        }

        function checkURLForReferral() {
            const urlParams = new URLSearchParams(window.location.search);
            const refAddress = urlParams.get('ref');
            if (refAddress && Web3.utils.isAddress(refAddress)) {
                referralAddress = refAddress;
                document.getElementById('referrerAddress').value = refAddress;
                showNotification('Referral address detected!', 'success');
            }
        }

        async function initializeApp() {
            try {
                web3 = new Web3(new Web3.providers.HttpProvider(READ_ONLY_RPC));
                contract = new web3.eth.Contract(CONTRACT_ABI, CONTRACT_ADDRESS);
                await loadGlobalStats();
            } catch (error) {
                console.error('Error init:', error);
            }
            if (typeof window.ethereum !== 'undefined') {
                 try {
                    const accounts = await window.ethereum.request({ method: 'eth_accounts' });
                    if (accounts.length > 0) await connectWallet();
                 } catch (err) {}
            }
        }

        async function loadGlobalStats() {
            if (!contract) return;
            try {
                const stats = await contract.methods.getPlatformStats().call();
                const formatUSDT = (weiValue) => parseFloat(web3.utils.fromWei(weiValue, 'ether')).toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2});
                
                document.getElementById('statTvl').textContent = `${formatUSDT(stats.contractBalance)} USDT`;
                document.getElementById('statTotalUsers').textContent = parseInt(stats.totalInvestors_).toLocaleString('en-US');
                document.getElementById('statTotalDeposit').textContent = `${formatUSDT(stats.totalInvested_)} USDT`;
                document.getElementById('statTotalPaidOut').textContent = `${formatUSDT(stats.totalWithdrawn_)} USDT`;
            } catch (error) {
                console.error('Error stats:', error);
            }
        }

        async function connectWallet() {
            if (typeof window.ethereum === 'undefined') return showNotification('Please install MetaMask or Trust Wallet!', 'error');
            try {
                web3 = new Web3(window.ethereum);
                contract = new web3.eth.Contract(CONTRACT_ABI, CONTRACT_ADDRESS);
                usdtContract = new web3.eth.Contract(USDT_ABI, USDT_ADDRESS);

                const chainId = await window.ethereum.request({ method: 'eth_chainId' });
                if (chainId !== '0x38') {
                     try {
                        await window.ethereum.request({ method: 'wallet_switchEthereumChain', params: [{ chainId: '0x38' }] });
                    } catch (switchError) {
                        if (switchError.code === 4902) {
                            await window.ethereum.request({ 
                                method: 'wallet_addEthereumChain', 
                                params: [{ chainId: '0x38', chainName: 'Binance Smart Chain', nativeCurrency: { name: 'BNB', symbol: 'BNB', decimals: 18 }, rpcUrls: ['https://bsc-dataseed.binance.org/'], blockExplorerUrls: ['https://bscscan.com/'] }] 
                            });
                        } else throw switchError;
                    }
                }
                const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
                if (accounts.length > 0) {
                    userAccount = accounts[0];
                    updateWalletUI();
                    loadUserData();
                    showNotification('Wallet connected successfully!', 'success');
                }
            } catch (error) {
                showNotification('Wallet connection failed. Please try again.', 'error');
            }
        }

        function setupEventListeners() {
            navToggle.addEventListener('click', () => navMenu.classList.toggle('active'));
            document.addEventListener('click', (e) => {
                if (navMenu.classList.contains('active') && !navMenu.contains(e.target) && !navToggle.contains(e.target)) navMenu.classList.remove('active');
            });
            document.querySelectorAll('.nav__link, button[data-section]').forEach(el => {
                el.addEventListener('click', (e) => {
                    e.preventDefault();
                    const targetElement = e.target.closest('[data-section]');
                    if (targetElement) {
                        showSection(targetElement.getAttribute('data-section'));
                        navMenu.classList.remove('active');
                    }
                });
            });
            connectWalletBtn.addEventListener('click', connectWallet);
            document.getElementById('backToPlans').addEventListener('click', showPlans);
            document.getElementById('confirmInvestment').addEventListener('click', confirmInvestment);
            document.getElementById('newInvestment').addEventListener('click', () => {
                investmentSuccessPopup.classList.remove('active');
                showPlans();
            });
            document.getElementById('investmentAmount').addEventListener('input', updateInvestmentSummary);
            investmentSuccessPopup.addEventListener('click', (e) => { if (e.target === investmentSuccessPopup) investmentSuccessPopup.classList.remove('active'); });
            document.getElementById('withdrawROI').addEventListener('click', withdrawROI);
            document.getElementById('withdrawReferral').addEventListener('click', withdrawReferral);
            document.getElementById('withdrawLeadership').addEventListener('click', withdrawLeadership);
            document.getElementById('copyLink').addEventListener('click', copyReferralLink);
            
            if (window.ethereum) {
                window.ethereum.on('accountsChanged', (accounts) => {
                    userAccount = accounts.length > 0 ? accounts[0] : null;
                    updateWalletUI();
                    if(userAccount) loadUserData();
                    else {
                        showWalletAlerts();
                        generateReferralLevelsCompact();
                        generateLeadershipLevelsCompact();
                    }
                });
                window.ethereum.on('chainChanged', () => window.location.reload());
            }
        }

        function showSection(sectionName) {
            Object.values(sections).forEach(section => { if (section) section.style.display = 'none'; });
            document.querySelectorAll('.nav__link').forEach(link => link.classList.remove('active'));
            if (sections[sectionName]) {
                 sections[sectionName].style.display = 'flex';
                 if(sectionName !== 'home') sections[sectionName].style.flexDirection = 'column';
                window.scrollTo(0, 0);
                const navLink = document.querySelector(`.nav__link[data-section="${sectionName}"]`);
                if (navLink) navLink.classList.add('active');
                if (sectionName === 'dashboard' && userAccount) startWithdrawTimer();
                else stopWithdrawTimer();
            }
        }

        function updateWalletUI() {
            if (userAccount) {
                connectWalletBtn.innerHTML = `<i class="fas fa-wallet"></i> ${userAccount.substring(0, 6)}...${userAccount.substring(userAccount.length - 4)}`;
                hideWalletAlerts();
            } else {
                connectWalletBtn.innerHTML = `<i class="fas fa-wallet"></i> Connect Wallet`;
                showWalletAlerts();
            }
        }

        function showWalletAlerts() {
            ['dashboardWalletAlert', 'investWalletAlert', 'referralWalletAlert', 'leadershipWalletAlert'].forEach(id => document.getElementById(id).style.display = 'flex');
            ['quickStats', 'actionButtons', 'noInvestmentsMessage', 'referralStats', 'referralLinkSection', 'referralActionButtons', 'leadershipStats', 'leadershipActionButtons', 'investmentHistoryContainer'].forEach(id => {
                const el = document.getElementById(id);
                if (el) el.style.display = 'none';
            });
        }

        function hideWalletAlerts() {
            ['dashboardWalletAlert', 'investWalletAlert', 'referralWalletAlert', 'leadershipWalletAlert'].forEach(id => document.getElementById(id).style.display = 'none');
             ['quickStats', 'referralStats', 'leadershipStats'].forEach(id => {
                 const el = document.getElementById(id);
                if (el) el.style.display = 'grid';
            });
            document.getElementById('actionButtons').style.display = 'flex';
            document.getElementById('referralActionButtons').style.display = 'flex';
            document.getElementById('leadershipActionButtons').style.display = 'flex';
            document.getElementById('referralLinkSection').style.display = 'block';
            document.getElementById('investmentHistoryContainer').style.display = 'block';
        }

        async function loadUserData() {
            if (!contract || !userAccount) return;
            try {
                const userInfo = await contract.methods.getUserInfo(userAccount).call();
                const pendingRewards = await contract.methods.getPendingRewards(userAccount).call();
                const teamCount = await contract.methods.getTeamMembersCount(userAccount).call();
                const formatUSDT = (weiValue) => parseFloat(web3.utils.fromWei(weiValue, 'ether')).toFixed(2);
                
                document.getElementById('totalInvested').textContent = `${formatUSDT(userInfo.totalInvested)} USDT`;
                document.getElementById('pendingRewards').textContent = `${formatUSDT(pendingRewards)} USDT`;
                document.getElementById('referralBonusAmount').textContent = `${formatUSDT(userInfo.referralBonus)} USDT`;
                document.getElementById('leadershipBonusStats').textContent = `${formatUSDT(userInfo.leadershipBonus)} USDT`;
                document.getElementById('referralTeamCount').textContent = teamCount;
                document.getElementById('leadershipTeamCount').textContent = teamCount;
                
                let userLevel = 0;
                const referralRequirements = await contract.methods.getReferralRequirements().call();
                for (let i = 0; i < referralRequirements.length; i++) {
                    if (new BigNumber(userInfo.totalInvested).isGreaterThanOrEqualTo(new BigNumber(referralRequirements[i]))) userLevel = i + 1;
                    else break;
                }
                document.getElementById('referralLevel').textContent = userLevel;
                
                let leadershipLevel = 0;
                const leadershipRequirements = await contract.methods.getLeadershipRequirements().call();
                for (let i = 0; i < leadershipRequirements.length; i++) {
                    if (parseInt(teamCount) >= parseInt(leadershipRequirements[i])) leadershipLevel = i + 1;
                    else break;
                }
                document.getElementById('currentLeadershipLevel').textContent = leadershipLevel;

                const investments = await contract.methods.getUserInvestments(userAccount).call();
                document.getElementById('noInvestmentsMessage').style.display = investments.planIds.length === 0 ? 'block' : 'none';

                generateReferralLink();
                document.getElementById('referralLinkSection').style.display = 'block';
                
                // Load investment history
                await loadInvestmentHistory(investments);
                
                // Load referral counts for each level
                await loadReferralLevelsWithCounts();
                
                generateLeadershipLevelsCompact(teamCount);
                startWithdrawTimer();

            } catch (error) { console.error('Error loading user data', error); }
        }

        async function loadInvestmentHistory(investments) {
            const investmentHistoryList = document.getElementById('investmentHistoryList');
            const noInvestmentHistory = document.getElementById('noInvestmentHistory');
            const totalInvestmentsCount = document.getElementById('totalInvestmentsCount');
            
            if (!investments || investments.planIds.length === 0) {
                investmentHistoryList.style.display = 'none';
                noInvestmentHistory.style.display = 'block';
                totalInvestmentsCount.textContent = '0';
                return;
            }
            
            investmentHistoryList.style.display = 'block';
            noInvestmentHistory.style.display = 'none';
            totalInvestmentsCount.textContent = investments.planIds.length;
            
            // Clear existing items
            investmentHistoryList.innerHTML = '';
            
            const planNames = {
                0: 'Gold Plan',
                1: 'Platinum Plan',
                2: 'Diamond Plan'
            };
            
            const formatUSDT = (weiValue) => parseFloat(web3.utils.fromWei(weiValue, 'ether')).toFixed(2);
            
            for (let i = 0; i < investments.planIds.length; i++) {
                const planId = investments.planIds[i];
                const amount = investments.amounts[i];
                const totalClaimed = investments.totalClaimeds[i];
                const isActive = investments.actives[i];
                const pendingRewards = investments.pendingRewards[i];
                
                const planName = planNames[planId] || `Plan ${planId}`;
                const formattedAmount = formatUSDT(amount);
                const formattedEarned = formatUSDT(totalClaimed);
                
                let status = 'expired';
                let statusClass = 'status-expired';
                
                if (isActive) {
                    status = 'active';
                    statusClass = 'status-active';
                } else if (parseFloat(formattedEarned) > 0) {
                    status = 'completed';
                    statusClass = 'status-completed';
                }
                
                const investmentItem = document.createElement('div');
                investmentItem.className = 'investment-history-item';
                investmentItem.innerHTML = `
                    <div class="investment-plan">
                        <div style="font-weight: 700; color: white;">${planName}</div>
                        <div style="font-size: 0.8rem; color: var(--text-muted);">ID: ${planId}</div>
                    </div>
                    <div class="investment-amount">
                        ${formattedAmount} USDT
                    </div>
                    <div class="investment-earned">
                        ${formattedEarned} USDT
                    </div>
                    <div class="investment-status ${statusClass}">
                        ${status.toUpperCase()}
                    </div>
                `;
                
                investmentHistoryList.appendChild(investmentItem);
            }
        }

        async function loadReferralLevelsWithCounts() {
            if (!contract || !userAccount) return;
            
            try {
                const referralCounts = [];
                // Get referral counts for each level
                for (let i = 0; i < 15; i++) {
                    try {
                        const count = await contract.methods.getReferralsCountByLevel(userAccount, i + 1).call();
                        referralCounts.push(parseInt(count));
                    } catch (error) {
                        referralCounts.push(0);
                    }
                }
                
                generateReferralLevelsCompactWithCounts(referralCounts);
            } catch (error) {
                console.error('Error loading referral counts:', error);
                // Fallback if function not available
                const emptyCounts = Array(15).fill(0);
                generateReferralLevelsCompactWithCounts(emptyCounts);
            }
        }

        function startWithdrawTimer() {
            stopWithdrawTimer();
            if (!contract || !userAccount) return;
            withdrawTimerInterval = setInterval(async () => {
                try {
                    const nextWithdrawTime = await contract.methods.getNextWithdrawTime(userAccount).call();
                    const currentTime = Math.floor(Date.now() / 1000);
                    if (nextWithdrawTime === '0') { document.getElementById('withdrawTimer').style.display = 'none'; return; }
                    const timeRemaining = parseInt(nextWithdrawTime) - currentTime;
                    if (timeRemaining <= 0) {
                        document.getElementById('withdrawTimer').style.display = 'none';
                        document.getElementById('withdrawROI').disabled = false;
                        document.getElementById('withdrawROI').innerHTML = '<i class="fas fa-download"></i> Withdraw ROI';
                    } else {
                        document.getElementById('withdrawTimer').style.display = 'inline-flex';
                        document.getElementById('withdrawROI').disabled = true;
                        document.getElementById('withdrawROI').innerHTML = '<i class="fas fa-clock"></i> Locked';
                        updateTimerDisplay(timeRemaining);
                    }
                } catch (error) {}
            }, 1000);
        }

        function stopWithdrawTimer() { if (withdrawTimerInterval) { clearInterval(withdrawTimerInterval); withdrawTimerInterval = null; } }

        function updateTimerDisplay(seconds) {
            const h = Math.floor(seconds / 3600);
            const m = Math.floor((seconds % 3600) / 60);
            const s = seconds % 60;
            document.getElementById('timerHours').textContent = h.toString().padStart(2, '0');
            document.getElementById('timerMinutes').textContent = m.toString().padStart(2, '0');
            document.getElementById('timerSeconds').textContent = s.toString().padStart(2, '0');
        }

        function generateReferralLink() {
            const linkInput = document.getElementById('referralLink');
            if (linkInput && userAccount) linkInput.value = `${window.location.origin}${window.location.pathname}?ref=${userAccount}`;
        }

        function generateInvestmentPlans() {
            const plansContainer = document.getElementById('investmentPlans');
            if (!plansContainer) return;
            const plans = [
                {id: 0, name: 'Gold Plan', roi: '16% Daily', range: '10 - 100 USDT', duration: '7 Days', total: '112% Total Returns', features: ['16% Daily ROI', '7 Days Duration', '112% Total Returns'], featured: false},
                {id: 1, name: 'Platinum Plan', roi: '9% Daily', range: '50 - 100 USDT', duration: '14 Days', total: '126% Total Returns', features: ['9% Daily ROI', '14 Days Duration', '126% Total Returns'], featured: true},
                {id: 2, name: 'Diamond Plan', roi: '5% Daily', range: '100+ USDT', duration: '30 Days', total: '150% Total Returns', features: ['5% Daily ROI', '30 Days Duration', '150% Total Returns'], featured: false}
            ];
            plansContainer.innerHTML = plans.map(plan => `
                <div class="plan-card ${plan.featured ? 'featured' : ''}" data-plan-id="${plan.id}">
                    <div class="plan-name">${plan.name}</div>
                    <div class="plan-roi">${plan.roi}</div>
                    <div class="plan-range">${plan.range}</div>
                    <ul class="plan-features">${plan.features.map(f => `<li><i class="fas fa-check"></i> ${f}</li>`).join('')}</ul>
                    <div class="plan-total">${plan.total}</div>
                    <button class="btn btn--primary" style="margin-top: auto;">Select Plan</button>
                </div>
            `).join('');
            document.querySelectorAll('.plan-card').forEach(card => card.addEventListener('click', (e) => selectPlan(parseInt(e.currentTarget.getAttribute('data-plan-id')))));
        }

        function selectPlan(planId) {
            if (!userAccount) return showNotification('Please connect your wallet first!', 'error');
            const plansData = [{ id: 0, name: 'Gold Plan', roi: '16% Daily', min: 10, max: 100 }, { id: 1, name: 'Platinum Plan', roi: '9% Daily', min: 50, max: 100 }, { id: 2, name: 'Diamond Plan', roi: '5% Daily', min: 100, max: Infinity }];
            selectedPlan = plansData.find(p => p.id === planId);
            if (selectedPlan) showInvestmentForm();
        }

        function showInvestmentForm() {
            document.getElementById('investmentPlans').style.display = 'none';
            document.getElementById('investmentForm').style.display = 'block';
            document.getElementById('selectedPlanSummary').innerHTML = `<div style="color:white; font-weight:700;">${selectedPlan.name}</div><div style="color:var(--primary-accent);">${selectedPlan.roi}</div>`;
            const maxText = selectedPlan.max === Infinity ? 'Unlimited' : selectedPlan.max;
            document.getElementById('amountRange').textContent = `Min: ${selectedPlan.min} USDT, Max: ${maxText} USDT`;
            const amountInput = document.getElementById('investmentAmount');
            amountInput.min = selectedPlan.min;
            amountInput.value = '';
            updateInvestmentSummary();
        }

        function showPlans() {
            document.getElementById('investmentPlans').style.display = 'grid';
            document.getElementById('investmentForm').style.display = 'none';
            selectedPlan = null;
        }

        function updateInvestmentSummary() {
            // Removed fee and total pay display as requested
        }

        async function confirmInvestment() {
            if (!contract || !userAccount) return showNotification('Please connect your wallet first!', 'error');
            if (!selectedPlan) return showNotification('Please select a plan', 'error');
            const amount = parseFloat(document.getElementById('investmentAmount').value) || 0;
            if (amount < selectedPlan.min || (selectedPlan.max !== Infinity && amount > selectedPlan.max)) return showNotification('Invalid investment amount. Please check the plan requirements.', 'error');
            let refAddr = document.getElementById('referrerAddress').value.trim() || referralAddress || '0x0000000000000000000000000000000000000000';
            
            const confirmBtn = document.getElementById('confirmInvestment');
            confirmBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Processing...';
            confirmBtn.disabled = true;

            try {
                const amountWei = web3.utils.toWei(amount.toString(), 'ether');
                const allowance = await usdtContract.methods.allowance(userAccount, CONTRACT_ADDRESS).call();
                if (new BigNumber(allowance).isLessThan(new BigNumber(amountWei))) {
                    await usdtContract.methods.approve(CONTRACT_ADDRESS, '115792089237316195423570985008687907853269984665640564039457584007913129639935').send({ from: userAccount });
                }
                await contract.methods.invest(selectedPlan.id, amountWei, refAddr).send({ from: userAccount });
                showNotification('Investment completed successfully!', 'success');
                investmentSuccessPopup.classList.add('active');
                await loadUserData(); await loadGlobalStats();
            } catch (error) {
                showNotification('Investment transaction failed. Please try again.', 'error');
            } finally {
                confirmBtn.innerHTML = '<i class="fas fa-check-circle"></i> Confirm Investment';
                confirmBtn.disabled = false;
            }
        }

        async function withdrawROI() {
            if (!contract || !userAccount) return showNotification('Please connect your wallet first!', 'error');
            const btn = document.getElementById('withdrawROI'); btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Withdrawing...'; btn.disabled = true;
            try { 
                await contract.methods.withdrawROI().send({ from: userAccount }); 
                showNotification('ROI withdrawal successful!', 'success'); 
                loadUserData(); 
            } catch (error) { 
                showNotification('ROI withdrawal failed. Please try again.', 'error'); 
            } finally { 
                btn.innerHTML = '<i class="fas fa-download"></i> Withdraw ROI'; 
                btn.disabled = false; 
            }
        }
        async function withdrawReferral() {
             if (!contract || !userAccount) return showNotification('Please connect your wallet first!', 'error');
            try { 
                await contract.methods.withdrawReferral().send({ from: userAccount }); 
                showNotification('Referral earnings withdrawal successful!', 'success'); 
                loadUserData(); 
            } catch (error) { 
                showNotification('Referral withdrawal failed. Please try again.', 'error'); 
            }
        }
        async function withdrawLeadership() {
             if (!contract || !userAccount) return showNotification('Please connect your wallet first!', 'error');
            try { 
                await contract.methods.withdrawLeadership().send({ from: userAccount }); 
                showNotification('Leadership bonus withdrawal successful!', 'success'); 
                loadUserData(); 
            } catch (error) { 
                showNotification('Leadership withdrawal failed. Please try again.', 'error'); 
            }
        }

        function copyReferralLink() {
            navigator.clipboard.writeText(document.getElementById('referralLink').value).then(() => showNotification('Referral link copied to clipboard!', 'success'));
        }

        function generateReferralLevelsCompactWithCounts(referralCounts = Array(15).fill(0)) {
            const levelsContainer = document.getElementById('referralLevelsCompact');
            if (!levelsContainer) return;
            const levels = [
                { l: 1, c: '15%', r: '10', members: referralCounts[0] },
                { l: 2, c: '10%', r: '50', members: referralCounts[1] },
                { l: 3, c: '5%', r: '100', members: referralCounts[2] },
                { l: 4, c: '5%', r: '150', members: referralCounts[3] },
                { l: 5, c: '3%', r: '200', members: referralCounts[4] },
                { l: 6, c: '3%', r: '250', members: referralCounts[5] },
                { l: 7, c: '3%', r: '300', members: referralCounts[6] },
                { l: 8, c: '2%', r: '350', members: referralCounts[7] },
                { l: 9, c: '2%', r: '400', members: referralCounts[8] },
                { l: 10, c: '2%', r: '450', members: referralCounts[9] },
                { l: 11, c: '1%', r: '500', members: referralCounts[10] },
                { l: 12, c: '1%', r: '550', members: referralCounts[11] },
                { l: 13, c: '1%', r: '600', members: referralCounts[12] },
                { l: 14, c: '1%', r: '650', members: referralCounts[13] },
                { l: 15, c: '1%', r: '700', members: referralCounts[14] }
            ];
            levelsContainer.innerHTML = levels.map(level => `
                <div class="referral-level-compact">
                    <div class="level-number-compact">${level.l}</div>
                    <div class="level-commission-compact">${level.c}</div>
                    <div class="level-requirement-compact">${level.r} USDT</div>
                    <div class="level-members-compact" style="font-size: 0.7rem; color: var(--cyan-glow); margin-top: 4px;">
                        Members: ${level.members}
                    </div>
                </div>
            `).join('');
        }

        function generateReferralLevelsCompact() {
            // Initial empty state
            generateReferralLevelsCompactWithCounts(Array(15).fill(0));
        }

        function generateLeadershipLevelsCompact(teamCount = 0) {
            const levelsContainer = document.getElementById('leadershipLevelsCompact');
            if (!levelsContainer) return;
            const levels = [
                { l: 1, t: 'Leader', b: '3%', r: '200' },
                { l: 2, t: 'Senior', b: '7%', r: '500' },
                { l: 3, t: 'Executive', b: '10%', r: '1000' }
            ];
            levelsContainer.innerHTML = levels.map(level => `
                <div class="leadership-level-compact">
                    <div class="level-number-compact">${level.l}</div>
                    <div style="font-weight:600; color:white;">${level.t}</div>
                    <div class="level-commission-compact">${level.b}</div>
                    <div class="level-requirement-compact">${level.r} Members</div>
                </div>
            `).join('');
        }

        function showNotification(message, type = 'info') {
            notification.textContent = message; 
            notification.className = `notification ${type} show`;
            
            // Add appropriate icon based on type
            let icon = '';
            switch(type) {
                case 'success':
                    icon = '<i class="fas fa-check-circle"></i>';
                    break;
                case 'error':
                    icon = '<i class="fas fa-exclamation-circle"></i>';
                    break;
                case 'warning':
                    icon = '<i class="fas fa-exclamation-triangle"></i>';
                    break;
                default:
                    icon = '<i class="fas fa-info-circle"></i>';
            }
            
            notification.innerHTML = `${icon} ${message}`;
            
            setTimeout(() => notification.classList.remove('show'), 5000);
        }

        function checkPreloader() { window.addEventListener('load', () => setTimeout(() => preloader.classList.add('fade-out'), 500)); }
    </script>
</body>
</html>
